<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="../../topui/topui.js"></script>
<script type="text/javascript" src="../../js/author/common.js"></script>
<link rel="stylesheet" href="../../css/common/style.css" type="text/css"></link>
</head>
<body style="padding: 10px;">
	<table id="tblDictType" class="easyui-datagrid" title="业务字典大类信息列表"
		style="width: 98%"
		data-options="rownumbers:true,singleSelect:true,pagination:true,pageSize:20,pageList:[15, 20, 50],fitColumns:true,url:'/opas-naps/dict_list.json',loadMsg:'数据加载中.....',method:'post',toolbar:'#dictTypeCondion'">
		<thead>
			<tr>
				<th field="id" align="center" checkbox="true">全选</th>
				<th field="dictName" width="13%" align="left">大类名称</th>
				<th field="dictCode" width="13%" align="left">大类编码(字节)</th>
				<th field="crtUser" width="13%" align="center">创建人</th>
				<th field="crtTime" width="13%" align="center"
					data-options="formatter:gridDateFormat2">创建时间</th>
				<th field="operate" width="30%" align="center"
					data-options="formatter:fmtDictType">操作</th>
			</tr>
		</thead>
	</table>
	<div id="dictTypeCondion" style="padding: 10px; text-align: center;">
		<form id="seachDictTypeForm">
			大类名称: <input class="easyui-textbox" style="width: 110px"
				name="dictName" id="dictName"> 大类编码: <input
				class="easyui-textbox" style="width: 110px" name="dictCode"
				id="dictCode"> <a
				href="javascript:common.searchTbl('seachDictTypeForm','tblDictType');"
				class="easyui-linkbutton" iconCls="icon-search">查询</a>&nbsp;<a
				href="javascript:common.openWin('dictTypeAdd');"
				class="easyui-linkbutton" iconCls="icon-add">新增</a>&nbsp;<a
				href="javascript:refshDictAll();" class="easyui-linkbutton"
				iconCls="icon-reload">全量刷新</a>
		</form>
	</div>

	<div id="dictTypeAdd" class="easyui-window" title="业务字典大类添加"
		style="width: 550px; height: 300px" top="200"
		data-options="iconCls:'icon-save',modal:true,closed:true">
		<div class="easyui-layout" data-options="fit:true">
			<div data-options="region:'center'">
				<form id="dictTypeForm" class="easyui-form" method="post"
					data-options="novalidate:true">
					<table cellpadding="5">
						<tr>
							<td>大类名称:</td>
							<td><input class="easyui-textbox" id="dictName" type="text"
								name="dictName" data-options="required:true"></input> <input
								type="hidden" name="dictId" id="dictId" /></td>
							<td>大类编码:</td>
							<td><input class="easyui-textbox" id="dictCode" type="text"
								name="dictCode"  data-options="required:true">
								</input></td>
						</tr>
						<tr>
							<td colspan="2" align="right"><a href="javascript:void(0)"
								class="easyui-linkbutton"
								onclick="common.closeWin('dictTypeAdd','dictTypeForm')">取消</a></td>
							<td colspan="2" align="left"><a href="javascript:void(0)"
								class="easyui-linkbutton"
								onclick="common.formSub('tblDictType','dictTypeAdd','dictTypeForm','/opas-naps/dict_add.json')">保存</a></td>
						</tr>
					</table>
				</form>
			</div>
		</div>
	</div>

	<div id="dictTypeEdit" class="easyui-window" title="业务大类大类修改"
		style="width: 550px; height: 300px" top="200"
		data-options="iconCls:'icon-save',modal:true,closed:true">
		<div class="easyui-layout" data-options="fit:true">
			<div data-options="region:'center'">
				<form id="dictTypeEditForm" class="easyui-form" method="post"
					data-options="novalidate:true">
					<table cellpadding="5">
						<tr>
							<td>大类名称:</td>
							<td><input class="easyui-textbox" id="dictName" type="text"
								name="dictName" data-options="required:true"></input> <input
								type="hidden" name="dictId" id="dictId" /></td>
							<td>大类编码:</td>
							<td><input class="easyui-textbox" id="dictCode" type="text"
								name="dictCode" data-options="required:true"></input></td>
						</tr>
						<tr>
							<td colspan="2" align="right"><a href="javascript:void(0)"
								class="easyui-linkbutton"
								onclick="common.closeWin('dictTypeEdit','dictTypeForm')">取消</a></td>
							<td colspan="2" align="left"><a href="javascript:void(0)"
								class="easyui-linkbutton"
								onclick="common.formSub('tblDictType','dictTypeEdit','dictTypeEditForm','/opas-naps/dict_update.json')">保存</a></td>
						</tr>
					</table>
				</form>
			</div>
		</div>
	</div>

	<div id="dictWin" class="easyui-window" title="业务字典小类信息"
		style="width: 900px; height: 600px;"
		data-options="iconCls:'icon-save',modal:true,closed:true">
		<div class="easyui-layout" data-options="fit:true">
			<div data-options="region:'center'">
				<table id="tblDict" class="easyui-datagrid"
					data-options="rownumbers:true,singleSelect:true,pagination:true,fitColumns:true,loadMsg:'数据加载中.....',method:'post',toolbar:'#dictCondion'">
					<thead>
						<tr>
							<th field="id" align="center" checkbox="true">全选</th>
							<th field="dictDetailName" width="35%">小类名称</th>
							<th field="dictDetailCode" width="13%" align="center">小类编码(字节)</th>
							<th field="crtUser" width="13%" align="center">创建人</th>
							<th field="crtTime" width="17%" align="center"
								data-options="formatter:gridDateFormat2">创建时间</th>
							<th field="operate" width="10%" align="center"
								data-options="formatter:fmtDict">操作</th>
						</tr>
					</thead>
				</table>
				<div id="dictCondion" style="padding: 10px; text-align: center;">
					<form id="seachDictForm">
						小类名称: <input class="easyui-textbox" style="width: 110px" name="dictDetailName" id="dictDetailName" > 
						小类编码: <input class="easyui-textbox" style="width: 110px" name="dictDetailCode" id="dictDetailCode" > 
								<input type="hidden" name="dictId" id="dictId" /> 
								<a href="javascript:common.searchTbl('seachDictForm','tblDict');"
								      class="easyui-linkbutton" iconCls="icon-search">查询</a>&nbsp;
								<a href="javascript:common.openWin('dictAdd');"
							      class="easyui-linkbutton" iconCls="icon-add">新增</a>
					</form>
				</div>
			</div>
		</div>
	</div>

	<div id="dictAdd" class="easyui-window" title="业务字典小类添加"
		style="width: 550px; height: 300px" top="200"
		data-options="iconCls:'icon-save',modal:true,closed:true">
		<div class="easyui-layout" data-options="fit:true">
			<div data-options="region:'center'">
				<form id="dictForm" class="easyui-form" method="post"
					data-options="novalidate:true">
					<table cellpadding="5">
						<tr>
							<td>小类名称:</td>
							<td><input class="easyui-textbox" id="dictDetailName"
								type="text" name="dictDetailName" data-options="required:true"></input>
								<!-- <input type="hidden" name="dictId" id="dictId" /> --></td>
							<td>小类编码:</td>
							<td><input class="easyui-textbox" id="dictDetailCode"
								type="text" name="dictDetailCode" data-options="required:true"></input></td>
						</tr>
						<tr>
							<td colspan="2" align="right"><a href="javascript:void(0)"
								class="easyui-linkbutton"
								onclick="common.closeWin('dictAdd','dictForm')">关闭</a></td>
							<td colspan="2" align="left"><a href="javascript:void(0)"
								class="easyui-linkbutton"
								onclick="formSubAdd('tblDict','dictAdd','dictForm','/opas-naps/dict_detail_save.json')">保存</a></td>
						</tr>
					</table>
				</form>
			</div>
		</div>
	</div>

	<div id="dictEdit" class="easyui-window" title="业务字典小类修改"
		style="width: 550px; height: 300px" top="200"
		data-options="iconCls:'icon-save',modal:true,closed:true">
		<div class="easyui-layout" data-options="fit:true">
			<div data-options="region:'center'">
				<form id="dictEditForm" class="easyui-form" method="post"
					data-options="novalidate:true">
					<table cellpadding="5">
						<tr>
							<td>小类名称:</td>
							<td><input class="easyui-textbox" id="dictDetailName"
								 name="dictDetailName" required="true"></input>
								<input type="hidden" name="dictDetailId" id="dictDetailId" /></input>
								<input type="hidden" name="dictId" id="dictId" /></td>
							<td>小类编码:</td>
							<td><input class="easyui-textbox" id="dictDetailCode"
								type="text" name="dictDetailCode" data-options="required:true"></input></td>
						</tr>
					</table>
				</form>

				<div style="text-align: center; padding: 5px">
					<a href="javascript:void(0)" class="easyui-linkbutton"
						onclick="common.formSub('tblDict','dictEdit','dictEditForm','/opas-naps/dict_detail_update.json')">保存</a>&nbsp;<a
						href="javascript:void(0)" class="easyui-linkbutton"
						onclick="common.closeWin('dictEdit','dictForm')">关闭</a>
				</div>
			</div>
		</div>
	</div>
</body>
<script>
	//大类添加操作
	function fmtDictType(val, row, index) {
		return "<a name='upload' href=javascript:common.openWinTbl('dictWin','tblDictType','tblDict','/opas-naps/dict_detail_list.json','dictId');>小类管理</a>&nbsp;<a name='edit' class='easyui-linkbutton' href='javascript:common.editOperate(\"tblDictType\",\"dictTypeEdit\",\"dictTypeEditForm\");'>修改</a>&nbsp;<a name='del' class='easyui-linkbutton' href='javascript:common.deleteTbl(\"tblDictType\",\"/opas-naps/dict_remove.json\");'>删除</a>&nbsp;<a name='del' class='easyui-linkbutton' href='javascript:refshDict(\""
				+ row.dictCode + "\")'>刷新</a>";
	}

	//小类添加操作
	function fmtDict(val, row, index) {
		return "<a name='edit' class='easyui-linkbutton' href='javascript:common.editOperate(\"tblDict\",\"dictEdit\",\"dictEditForm\");'>修改</a>&nbsp;<a name='del' class='easyui-linkbutton' href='javascript:common.deleteTbl(\"tblDict\",\"/opas-naps/dict_detail_remove.json\");'>删除</a>";
	}

	//业务字典大类刷新
	function refshDict(dictCode) {
		$cf.ajax({
			data : {
				"dictCode" : dictCode
			},
			url : "/opas-naps/dictRefsh.json",
			onSuccess : function(node) {
				top.$cf.showMsg("刷新成功！");
			}
		});
	}

	//业务字典缓存全量刷新
	function refshDictAll() {
		$cf.ajax({
			data : {
				"dictCode" : dictCode
			},
			url : "/opas-naps/dictRefshAll.json",
			onSuccess : function(node) {
				top.$cf.showMsg("全量刷新成功！");
			}
		});
	}
	//新增 
	function formSubAdd(tblName, winName, formName, url) {
		var formObj = $("#" + formName + "");
		var tblObj = $("#" + tblName + "");
		var useDictId =$("#tblDictType").datagrid("getSelected").dictId;
		var param =formObj.serializeArray();
		var obj=new Object();
		obj.name='dictId';
		obj.value=useDictId;
		param.push(obj);
		var jsondata = common.getFormData(param);
		if(formName=="dictTypeForm"){//大类新增
			if (jsondata.dictName == null||jsondata.dictName==""|| jsondata.dictName.trim().length <=0 ) {
				$.messager.alert("操作提示","失败:大类名称不能为空!", "error");
				return true;
			}
			if (jsondata.dictCode == null || jsondata.dictCode.trim().length <=0 ) {
				$.messager.alert("操作提示", "失败:大类编码不能为空!", "error");
				return true;
			}
		}
		if(formName=="dictTypeEditForm"){//大类修改
			if (jsondata.dictName == null || jsondata.dictName.trim().length <=0 ) {
				$.messager.alert("操作提示","失败:大类名称不能为空!", "error");
				return true;
			}
			if (jsondata.dictCode == null || jsondata.dictCode.trim().length <=0 ) {
				$.messager.alert("操作提示", "失败:大类编码不能为空!", "error");
				return true;
			}
		}
		if(formName=="dictForm"){//小类新增
			if (jsondata.dictDetailName == null || jsondata.dictDetailName.trim().length <=0 ) {
				$.messager.alert("操作提示","失败:小类名称不能为空!", "error");
				return true;
			}
			if (jsondata.dictDetailCode == null || jsondata.dictDetailCode.trim().length <=0 ) {
				$.messager.alert("操作提示", "失败:小类编码不能为空!", "error");
				return true;
			}
		}
		if(formName=="dictEditForm"){//小类修改
			if (jsondata.dictDetailName == null || jsondata.dictDetailName.trim().length <=0 ) {
				$.messager.alert("操作提示","失败:小类名称不能为空!", "error");
				return true;
			}
			if (jsondata.dictDetailCode == null || jsondata.dictDetailCode.trim().length <=0 ) {
				$.messager.alert("操作提示", "失败:小类编码不能为空!", "error");
				return true;
			}
		}
		$cf.ajax({
			type : "post",
			url : url,
			data : jsondata,
			onSuccess : function(data) {
				tblObj.datagrid("reload");
				if (data.RSP_BODY.isSuccess) {
					$.messager.alert("操作提示", "操作成功！");
				}else if(data.RSP_BODY.isCode){
					$.messager.alert("操作提示", "业务字典编码重复！");
					return;
				}else if(data.RSP_BODY.isName){
					$.messager.alert("操作提示", "业务字典名称重复！");
					return;
				}
				common.closeWin(winName, formName);
			}
		});
	}
</script>
</html>
