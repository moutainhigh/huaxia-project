<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>组任务分配</title>
<link href="../../css/normalize.css" type="text/css" rel="stylesheet" />
<link href="../../css/normalize-ext.css" type="text/css"
	rel="stylesheet" />
<script src="../../topui/topui.js" type="text/javascript"></script>
<script src="../../topui/easyui/default/easyuiExt.js" type="text/javascript"></script>
<script src="../../js/author/common.js" type="text/javascript"></script>
<script src="../../js/author/allot.js" type="text/javascript"></script>
<METAHTIP-EQUIV="Pargma" CONTENT="no-cache">
<METAHTTP-EQUIV="Cache-Control" CONTENT="no-cache">
<METAHTTP-EQUIV="Expires" CONTENT="0">
<style type="text/css">
.area-tips {
	padding: 10px;
	text-align: right;
}

.area-function {
	text-align: center;
}

.area-function a {
	width: 50px;
}

.area-2-level {
	background-color: #F0F0F0;
}

.divHeight{
	_height:50px;
	min-height:50px;
	height:auto;
}

.divHeight2{
	_height:240px;
	min-height:240px;
	height:auto;
}

.area-transfer-level{
	background-color: #F0F0F0;
}

.area-recovery-level{
	background-color: #F0F0F0;
}
</style>
</head>
<body style="padding: 10px;">
<div  id="main_layout" style="width:98%;scroll:true;"> 
	<h1>组任务分配</h1>
	<fieldset>
		<legend>筛选条件</legend>
		<div class="area-tips">
			待分配：<em class="countAppId">0</em>件 / 快速审批件数量：<em class="quickAppId">0</em>件
			/ 查询结果：<strong id="info_query">0</strong>件
		</div>
		<div align="center">
			<form id="seachForm" method="post" accept-charset="UTF-8">
				<table>
					<tr>
						<td>流水号字母：</td>
						<td><select class="easyui-combobox" id="serialNum" name="serialNum"
							dict_type="ALLOT_SERIALNUM" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>展业地区：</td>
						<td><select class="easyui-combobox" name="appRegion" dict_type="ALLOT_APPREGION"
							editable="false"  id="appRegion" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>渠道：</td>
						<td><select class="easyui-combobox" name="appChannel" id="appChannel"
							dict_type="ALLOT_APPCHANNEL" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
					</tr>
					<tr>
						<td>录入商：</td>
						<td><select class="easyui-combobox" name="appInput"  id="appInput" 
							dict_type="ALLOT_APPINPUT" editable="false"  multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;" multiple="true">
						</select></td>
						<td>卡产品类型：</td>
						<td><select class="easyui-combobox" data-options="valueField:'cardCode',textField:'prodName'"
									style="width: 150px" name="appProd" id="appProd" multiple="true" >
							</select></td>
						<td>时间：</td>
						<td>
						<select class="easyui-combobox" name="shareTime"  id="shareTime"
							dict_type="ALLOT_SHARETIME" editable="false" id="shareTime"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<span>
							<input class="easyui-datebox" name="appTimeStart"  id="appTimeStart" style="width: 150px;"/>
							<input class="easyui-datebox" name="appTimeEnd"  id="appTimeEnd" style="width: 150px;"/>
							<input class="easyui-datebox" name="crtTimeStart"  id="crtTimeStart" style="width: 150px;"/>
							<input class="easyui-datebox" name="crtTimeEnd"  id="crtTimeEnd" style="width: 150px;"/>
						</span>
						</td>
					</tr>
					<tr>
						<td>异常进件渠道：</td>
						<td><select class="easyui-combobox" name="nosafePromoter" dict_type="ALLOT_NO_SAFE"
							editable="false" id="nosafePromoter"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
						<td>单位名称：</td>
						<td><input class="easyui-textbox" name="c1CoName" id="c1CoName"
							style="width: 150px;"></td>
						<td>邮寄地址：</td>
						<td>
						<select class="easyui-combobox" name="c4CyCadd1"
							dict_type="ALLOT_CARDTO1" editable="false" id="c4CyCadd1"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
					</tr>
					<tr>
						<td>团办号：</td>
						<td><input class="easyui-textbox" name="c4ApBatch"  id="c4ApBatch"
							 style="width: 96px;" />
							<a href="javascript:fnBatch();" 
							class="easyui-linkbutton" style="width: 50px;">查询</a></td>
						<td>项目号（专案代码）：</td><!-- added by jpc -->
						<td><input class="easyui-textbox" name="c5JcType"  id="c5JcType"
							 style="width: 96px;" />
							<a href="javascript:fnJCType();" 
							class="easyui-linkbutton" style="width: 50px;">查询</a></td>
					</tr>
					<tr>
						<td>推广机构号：</td>
						<td><input class="easyui-textbox" name="c5AbCode"  id="c5AbCode"
							 style="width: 96px;" />
							<a href="javascript:fnAbCode();"
							class="easyui-linkbutton" style="width: 50px;">查询</a></td>
						<td>推广人员代码：</td>
						<td><input class="easyui-textbox" name="c4AbUser" id="c4AbUser"
							 style="width: 96px;" />
							<a href="javascript:fnAbUser();"
							class="easyui-linkbutton" style="width: 50px;">查询</a></td>
					</tr>
					<tr>
						<td>中征信1000评分：</td>
						<td><input class="easyui-textbox" name="minNumberRead" id="minNumberRead"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
							-<input class="easyui-textbox" id="maxNumberRead" name="maxNumberRead"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
						</td>
						<td>申请件状态：</td>
						<td><select class="easyui-combobox" name="appStatus" dict_type="ALLOT_CURRSTATUS"
							editable="false"  id="appStatus" 
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>标识：</td>
						<td><select class="easyui-combobox" id="identify" name="identify" dict_type="ALLOT_IDENTIFY"
							editable="false"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<select class="easyui-combobox" 
							editable="false" id="child_1"  name="isHaveCardCust" dict_type="ALLOT_ISHAVECARD"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<select class="easyui-combobox" 
							editable="false" id="child_2"  name="quickCardFlag" dict_type="ALLOT_C4RUSHFLG"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<select class="easyui-combobox" 
							editable="false" id="child_3"  name="pubPolice" dict_type="YDJ_ALLOT_PUBPOLICE"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width:  150px;">
						</select>
						</td>
					
					</tr>
					<tr>
						<td>征信策略结果描述：</td>
						<td>
							<select class="easyui-combobox" name="creditDecisionLayer" dict_type="ALLOT_YDJ_CREDIT_DESCRIPTION"
							editable="false" id="creditDecisionLayer" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;" multiple="true">
						</select>
						</td> 
						<td>征信策略结果：</td>
						<td>
						<select class="easyui-combobox" name="creditDecisionResult" dict_type="ALLOT_YDJ_CREDIT"
							editable="false"  id="creditDecisionResult" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;" multiple="true">
						</select>
						</td>
						<td>系统决策建议额度：</td>
						<td><input class="easyui-textbox" name="minProposedLmt"  id="minProposedLmt"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
							-<input class="easyui-textbox" name="maxProposedLmt"   id="maxProposedLmt"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
						</td>
					</tr>
					<tr>
						<td>分配顺序：</td>
						<td>
							<select class="easyui-combobox" name="allotType" dict_type="ALLOT_ALLOTTYPE"
							editable="false" id="allotType"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
							</select>
						</td>
						<td>腾讯天御分：</td>
						<td><input class="easyui-textbox" name="minRiskScore" id="minRiskScore"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
							-<input class="easyui-textbox"  id="maxRiskScore" name="maxRiskScore"
							 style="width: 73px;"  data-options="validType:['number','maxLength[12]']" >
						</td>
						<td>手机实名认证结果：</td>
						<td><select class="easyui-combobox" name="phoneCertification" 
							 id="phoneCertification" style="width: 150px;" 
							 dict_type="ALLOT_PHONE_NEW" editable="false" multiple="true"
							 data-options="valueField:'dictDetailCode',textField:'dictDetailName'" >
							 </select></td>
					</tr>
					<tr>
						<td>反欺诈决策结果：</td>
						<td><select class="easyui-combobox" id="fqzValue" name="fqzValue"
							dict_type="ALLOT_FQZ" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>天御风险码：</td>
						<td><select class="easyui-combobox" name="riskCode" dict_type="ALLOT_RISKCODE"
							editable="false"  id="riskCode" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>天御风险码等级：</td>
						<td><select class="easyui-combobox" name="riskLevel" id="riskLevel"
							dict_type="ALLOT_RISKLEVEL" editable="false"  multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
					</tr> 
					 <tr>
						<td>过件码1：</td>
						<td>
						<select class="easyui-combobox" name="blockCode1" dict_type="ALLOT_ZX_BZK_CREDIT"
							editable="false"  id="blockCode1" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						</td>
						<td>过件码2：</td>
						<td>
						<select class="easyui-combobox" name="blockCode2" dict_type="ALLOT_BLOCKCODE"
							editable="false"  id="blockCode2" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						</td>
						<td>征信评分：</td>
						<td><input class="easyui-textbox" name="triggerType1" id="triggerType1"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
							-<input class="easyui-textbox" id="triggerType2" name="triggerType2"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
						</td>
					</tr> 
					<tr>
						<td>标签：</td>
						<td>
							<input type="checkbox" name="batchLabel" id="batchLabel" value="1" />批量&nbsp;&nbsp; 
							<input type="checkbox" name="pbocRstFinDesp" id="pbocRstFinDesp" value="1" />人行不良&nbsp;&nbsp;
							<input type="checkbox" name="appStatus2" id="appStatus2" value="24" />挂起 &nbsp;&nbsp;
							<input type="checkbox" name="stopStatus" id="stopStatus" value="1" />叫停 &nbsp;&nbsp;
							<input type="checkbox" name="secondDecisionLH" id="secondDecisionLH" value="1" />次策略捞回
						</td>
					</tr>
					<tr>
						<td>推荐来源：</td>
						<td><select class="easyui-combobox" name="rcdSrc" id="rcdSrc"
							dict_type="RCDSRC" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
						<td>平台类型：</td>
						<td><select class="easyui-combobox" name="platType" id="platType"
							dict_type="PLATTYPE" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
						<td>合作类型：</td>
						<td><select class="easyui-combobox" name="coprType" id="coprType"
							dict_type="COPRTYPE" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
					</tr>
					<tr>
						<td>平台风险层级：</td>
						<td><select class="easyui-combobox" name="platRiskLvl" id="platRiskLvl"
							dict_type="PLATRISKLVL" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
						<td>人像比对结果</td>
						<td>
							<select class="easyui-combobox" dict_type="ALLOT_RXBD"
							editable="false" id="policeRxbd"  name="policeRxbd" 
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
							</select>
						</td>
						<td>在网时长：</td>
						<td><select class="easyui-combobox" name="onlineTime" id="onlineTime"
							dict_type="ALLOT_ONLINE" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
					</tr>
					<tr>
						<td>组别：</td>
						<td>
							<select class="easyui-combobox" data-options="valueField:'orgNo',textField:'orgName'"
								style="width: 150px;" id="groupYdj" name="groupYdj" >
							</select>
						</td>
					</tr>
				</table>
			</form>
		</div>
		<div class="area-function">
			<a href="javascript:fnQuery();" class="easyui-linkbutton" >查询</a>&nbsp;
			<a href="javascript:buttonClean()" class="easyui-linkbutton">重置</a>
		</div>
	</fieldset>
	<div id="winBatch" class="easyui-window" 
		style="width: 600px; height: 400px" top="0"
		data-options="iconCls:'icon-save',modal:true,closed:true">
				<form id="batchForm" method="post">
					<table id="tblBatch" title="团办号代码列表" class="easyui-datagrid" style="width: 98%"
			       data-options="rownumbers:true,singleSelect:false,pagination:true,fitColumns:true,url:'',queryParams:{ydjFlag:'1'},loadMsg:'数据加载中.....',method:'post'">
					<thead>
							<tr>
							    <th field="Id" width="10%" align="center" checkbox="true">ID</th>
							    <th field="appCity" width="20%" align="center" data-options="formatter:formatAppCity">城市</th>
								<th field="c4ApBatch" width="20%" align="center">团办号代码</th>
								<th field="num" width="20%" align="center">申请件数量</th>
							</tr>
					</thead>
					</table>
				</form>
				<div style="text-align:center;padding:5px">
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onConcle('winBatch')">取消</a>
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onSaveBatch()">保存</a>
		        </div>
	</div>
	<!-- added by jpc  -->
	<div id="winType" class="easyui-window" style="width: 600px; height: 400px" top="0"
		data-options="iconCls:'icon-save',modal:true,closed:true">
		<form id="typeForm" method="post">
			<table id="tblType" title="项目号代码列表" class="easyui-datagrid" style="width: 98%"
	       data-options="rownumbers:true,singleSelect:false,pagination:true,pageSize:20,pageList:[20, 50,100,200],fitColumns:true,url:'',queryParams:{ydjFlag:'2'},loadMsg:'数据加载中.....',method:'post'">
			<thead>
				<tr>
				    <th field="Id" width="10%" align="center" checkbox="true">ID</th>
				    <th field="appCity" width="20%" align="center" data-options="formatter:formatAppCity" >城市</th>
					<th field="c5JcType" width="20%" align="center">项目号代码</th>
					<th field="num" width="20%" align="center">申请件数量</th>
				</tr>
			</thead>
			</table>
		</form>
		<div style="text-align:center;padding:5px">
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onConcle('winType')">取消</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onSaveType()">保存</a>
        </div>
	</div>
	<div id="winAbCode" class="easyui-window" title="推广机构号查询"
		style="width: 600px; height: 400px" top="0"
		data-options="iconCls:'icon-save',modal:true,closed:true">
				<form id="abCodeForm" method="post">
					<table id="tblAbCode" title="推广机构号代码列表" class="easyui-datagrid" style="width: 98%"
			       data-options="rownumbers:true,singleSelect:false,pagination:true,fitColumns:true,url:'',queryParams:{ydjFlag:'1'},loadMsg:'数据加载中.....',method:'post'">
					<thead>
							<tr>
							    <th field="Id" width="10%" align="center" checkbox="true">ID</th>
							    <th field="appCity2" width="20%" align="center" data-options="formatter:formatAppCity">城市</th>
								<th field="c5AbCode" width="20%" align="center">推广机构号代码</th>
								<th field="num2" width="20%" align="center">申请件数量</th>
							</tr>
						</thead>
					</table>
				</form>
				<div style="text-align:center;padding:5px">
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onConcle('winAbCode')">取消</a>
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onSaveAbCode()">保存</a>
		        </div>
	</div>
	<div id="winAbUser" class="easyui-window" title="推广人员号查询"
		style="width: 600px; height: 400px" top="0"
		data-options="iconCls:'icon-save',modal:true,closed:true">
				<form id="abUserForm" method="post">
					<table id="tblAbUser" title="推广人员号代码列表" class="easyui-datagrid" style="width: 98%"
			       data-options="rownumbers:true,singleSelect:false,pagination:true,fitColumns:true,url:'',queryParams:{ydjFlag:'1'},loadMsg:'数据加载中.....',method:'post'">
					<thead>
							<tr>
							    <th field="Id" width="10%" align="center" checkbox="true">ID</th>
							    <th field="appCity3" width="20%" align="center" data-options="formatter:formatAppCity">城市</th>
								<th field="c4AbUser" width="20%" align="center">推广人员代码</th>
								<th field="num3" width="20%" align="center">申请件数量</th>
							</tr>
						</thead>
					</table>
				</form>
				<div style="text-align:center;padding:5px">
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onConcle('winAbUser')">取消</a>
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onSaveAbUser()">保存</a>
		        </div>
	</div>
	<fieldset style="margin-top: 10px;">
		<legend>分配方式</legend>
		<div class="area-tips">
			已分配：<em id="info_alloted">0</em>件 / 剩余：<strong id="info_remainder">0</strong>件
		</div>
		<input type="hidden" id="hiddenId" name="hiddenId">
		<input type="hidden" id="allotFlag" name="allotFlag">
		<div id="area_1_level" class="divHeight" >
			分配类型：<select class="easyui-combobox" name="allot_type"
				id="allot_type" dict_type="" editable="false"
				data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
				style="width: 150px;">
				<option value="0">--请选择--</option>
				<option value="1">按件数</option>
				<option value="2">按比例</option>
				<option value="3">按特定件</option>
				<option value="4">按特定征信到特定审批</option>
			</select>
		</div>
		<!-- 分配-按件数 -->
		<div id="area_2_level_1" class="area-operate area-2-level">
		</div>
		<!-- 分配-按比例 -->
		<div id="area_2_level_2" class="area-operate area-2-level">
		</div>
		<!-- 分配-按特定件 -->
		<div id="area_2_level_3" class="area-operate area-2-level">
		</div>
		<!-- 特定征信到特定审批人 -->
		<div id="area_2_level_4" class="area-operate area-2-level">
		</div>
		<div class="area-function">
			<a href="javascript:fnAllot();" class="easyui-linkbutton"
				style="margin-left: 20px;">分配</a>&nbsp;<a
				href="javascript:fnReset()" class="easyui-linkbutton">重置</a>
		</div>
	</fieldset>
	<fieldset style="margin-top: 10px;">
		<legend>转移方式</legend>
		<div id="area_transfer_level" class="divHeight" >
			转移类型：<select class="easyui-combobox" name="allot_transfer"
				id="allot_transfer" dict_type="ALLOT_TRANSFER" editable="false"
				data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
				style="width: 150px;">
			</select>
			<input type="hidden" id="transferId" name="transferId">
			<input type="hidden" id="hideGroupNum" name="hideGroupNum">
		</div>
		<!-- 转移-按件数 -->
		<div id="area_transfer_level_1" class="area-transferDo  area-transfer-level">
		</div>
		<!-- 转移-按特定件 -->
		<div id="area_transfer_level_2" class="area-transferDo area-transfer-level">
		</div>
		<!-- 转移-按件数不同组 -->
		<div id="area_transfer_level_3" class="area-transferDo  area-transfer-level">
		</div>
		<!-- 转移-按特定件 不同组 跨组-->
		<div id="area_transfer_level_4" class="area-transferDo  area-transfer-level">
		</div>
		<div class="area-function">
			<a href="javascript:fnTransfer();" class="easyui-linkbutton"
				style="margin-left: 20px;">转移</a>
		</div>
	</fieldset>
	<fieldset style="margin-top: 10px;">
		<legend>回收方式</legend>
		<div id="area_recovery_level" class="divHeight" >
		回收类型：<select class="easyui-combobox" name="allot_recovery"
				id="allot_recovery"  editable="false"
				data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
				style="width: 150px;">
				<option value="0">--请选择--</option>
				<option value="1">按件数</option>
				<option value="2">按特定件</option>
			</select>
			<input type="hidden" id="recoveryId" name="recoveryId">
		</div>
		<!-- 回收-按件数 -->
		<div id="area_recovery_level_1" class="area-recoveryDo  area-recovery-level">
		</div>
		<!-- 回收-按特定件 -->
		<div id="area_recovery_level_2" class="area-recoveryDo area-recovery-level">
		</div>
		<div class="area-function2">
			<a href="javascript:fnRecovery();" class="easyui-linkbutton"
				style="margin-left: 20px;">回收</a>
		</div>
	</fieldset>
	<input type="hidden" id="jiSuan" name="jiSuan">
	</div>
	<script type="text/javascript">
		$cf.loadAllDict();
		var tblBatch = $("#tblBatch");
		var batchWindow = $("#winBatch");
		var batchForm = $("#batchForm");
		var tblType = $("#tblType");// added by jpc
		var typeWindow = $("#winType");// added by jpc
		var typeForm = $("#typeForm");// added by jpc
		var tblAbCode = $("#tblAbCode");
		var abCodeWindow = $("#winAbCode");
		var abCodeForm = $("#abCodeForm");
		var tblAbUser = $("#tblAbUser");
		var abUserWindow = $("#winAbUser");
		var abUserForm = $("#abUserForm");
		var node = "03";
		var secondNode="3";
		var ydjFlag="1";
		var userCode=$cf.getStore("userRelInfo","index").userInfo.userCode;
		var userName=$cf.getStore("userRelInfo","index").userInfo.userName;
		function init(){
			// 初始化
			fnInitIdentify();
			fnInitShow();
			fnInitTime();
			fnInitTransfer();
			fnInitRecovery();
			fnLoadAppProd();
		}
		$(function() {
			initDivHeight("area-function2");//距离底端距离
			init();
			//查询池中待分配件数量
			fnGetCount();
			// 重置筛选区域
			$('#btn_query_reset').click(function() {
				fnQueryAreaReset();
			});

			// 重置操作区域
			$('#btn_operate_reset').click(function() {
				fnOperateAreaReset();
			});

			// 根据筛选条件查询申请件并反显查询结果
			$('#btn_query_all').click(function() {
				$('#info_query').text('12500');
			});
			// [事件] select 联动
			$('#identify').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						$("#child_2+.combo").hide();
						$("#child_3+.combo").hide();
						$("#child_1+.combo").show();
						break;
					case '2':
						$("#child_1+.combo").hide();
						$("#child_3+.combo").hide();
						$("#child_2+.combo").show();
						break;
					case '3':
						$("#child_1+.combo").hide();
						$("#child_2+.combo").hide();
						$("#child_3+.combo").show();
						break;
					default:
						fnInitIdentify();
					}
					
				}
			});
			$('#shareTime').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						$("#crtTimeStart+.combo").hide();
						$("#crtTimeEnd+.combo").hide();
						$("#appTimeStart+.combo").show();
						$("#appTimeEnd+.combo").show();
						break;
					case '2':
						$("#appTimeStart+.combo").hide();
						$("#appTimeEnd+.combo").hide();
						$("#crtTimeStart+.combo").show();
						$("#crtTimeEnd+.combo").show();
						break;
					default:
						fnInitTime();
					}
					
				}
			});
			// [事件] 分配类型
			$('#area_1_level select').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						fnShowById(n);
						break;
					case '2':
						fnShowById(n);
						break;
					case '3':
						fnShowById(n);
						break;
					case '4':
						fnShowById(n);
						break;
					default:
						fnInitShow();
					}
					fnOperateAreaReset();
				}
			});
			//转移类型
			$('#area_transfer_level select').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						fnShowTransferById(n);
						break;
					case '2':
						fnShowTransferById(n);
						break;
					case '3':
						fnShowTransferById(n);
						break;
					case '4':
						fnShowTransferById(n);
						break;
					default:
						fnInitTransfer();
					}
					fnTransferAreaReset();
				}
			});
			//回收类型
			$('#area_recovery_level select').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						fnShowRecoveryById(n);
						break;
					case '2':
						fnShowRecoveryById(n);
						break;
					default:
						fnInitRecovery();
					}
					fnRecoveryAreaReset();
				}
			});
			$('#id_tree_type select').combobox({
				onChange : function(n, o) {
					var temp = $("#id_tree_type  option:selected").val(); 
					$("#temp").textbox('disable');
				}
			});
		});
		
		function fnQueryAreaReset() {
			$('#l_2').combobox('clear');
			$('#l_2').combobox('select', '0');
		}
		//分配重置
		function fnOperateAreaReset_1() {
			$('#area_2_level_1 input').val('');
		}

		function fnOperateAreaReset_2() {
			$('#area_2_level_2 input').val('');
		}

		function fnOperateAreaReset_3() {
			$('#area_2_level_3 input').val('');
		}

		function fnOperateAreaReset() {
			fnOperateAreaReset_1();
			fnOperateAreaReset_2();
			fnOperateAreaReset_3();
		}
		//转移重置 
		function fnTransferAreaReset() {
			$('#area_transfer_level_1 input').val('');
			$('#area_transfer_level_2 input').val('');
			$('#area_transfer_level_3 input').val('');
			$('#area_transfer_level_4 input').val('');
		}
		// 回收重置 
		function fnRecoveryAreaReset() {
			$('#area_recovery_level_1 input').val('');
			$('#area_recovery_level_2 input').val('');
		}
		function fnInitShow() {
			$('.area-operate').addClass('display');
			$('#area_1_level').removeClass('display');
		}
		function fnInitTransfer() {
			$('.area-transferDo').addClass('display');
			$('#area_transfer_level').removeClass('display');
		}
		function fnInitRecovery() {
			$('.area-recoveryDo').addClass('display');
			$('#area_recovery_level').removeClass('display');
		}
		function fnInitIdentify() {
			$("#child_1 +.combo").hide();
			$("#child_2 +.combo").hide();
			$("#child_3 +.combo").hide();
		}
		function fnInitTime(){
			$("#appTimeStart+.combo").hide();
			$("#appTimeEnd+.combo").hide();
			$("#crtTimeStart+.combo").hide();
			$("#crtTimeEnd+.combo").hide();
		}
		function fnInitc4CyCadd1(){
			$("#c1CoAdd").hide();
			$("#c1HmAdd").hide();
		}
		//待分配  及 快速件待分配 
		function fnGetCount(){
			$cf.ajax({
				url : "/opas-allot-server/countGroupApply.json",
				data:{'node':node,
					'secondNode':secondNode,
					'ydjFlag':'1',
					'userCode':userCode
					},
				onSuccess : function(respObj) {
					var count = respObj.RSP_BODY.total;
					var count2 = respObj.RSP_BODY.total2;
					$(".countAppId").text(count);
					$(".quickAppId").text(count2);
					$("#jiSuan").val(count);
				}
			});
		}
		//条件查询  查询满足条件的件
		function fnQuery() {
			var seachForm = $("#seachForm");
			var shareTimeValue=$("#shareTime").combobox("getValues");
			var appTimeStart = $('#appTimeStart').datebox('getValue');
			var appTimeEnd = $('#appTimeEnd').datebox('getValue');
			var crtTimeStart = $('#crtTimeStart').datebox('getValue');
			var crtTimeEnd = $('#crtTimeEnd').datebox('getValue');
			if(shareTimeValue == "1"){
				if(appTimeStart == "" || appTimeEnd == ""){//没有选择起止时间
					showWaringBox('请选择起止时间.');
					return null;
				}
				var appTimeDay = GetDateDiff(appTimeStart,appTimeEnd);
				if (appTimeDay > 6){
					alert("条形码日期区间不能超过7天");
					return;
				}
			}else if(shareTimeValue == "2"){
				if(crtTimeStart == "" || crtTimeEnd == ""){//没有选择起止时间
					showWaringBox('请选择起止时间.');
					return null;
				}
				var crtTimeDay = GetDateDiff(crtTimeStart,crtTimeEnd);
				if (crtTimeDay > 6){
					alert("进件日期区间不能超过7天");
					return;
				}
			}
			var jsondata = getFormMulData(seachForm.serializeArray());
			$cf.ajax({
				url : "/opas-allot-server/queryAppByConditions.json",
				data : {'jsondata':jsondata,
					'node':node,
					'secondNode':secondNode,
					'ydjFlag':'1',
					'userCode':userCode},
				onSuccess : function(respObj) {
					var count = respObj.RSP_BODY.total;
					$('#info_query').text(count);
					fnGetCount();
				}
			});
		}
		
		//分配 情况 
		function fnShowById(id) {
			$("input[name='hiddenId']").val(id);
			fnInitShow();
			var result = '';
			var specialFlag='0';
			if(id == '4'){//特定征信人员到特定审批人员
				specialFlag='1';
			}
			$cf.ajax({
						url : "/opas-allot-server/showAllotUser.json",
						data:{'node':node,
							'ydjFlag':'1',
							"orgLevel":'5',
							'secondNode':"3",
							'specialFlag':specialFlag,
							'userCode':userCode
							},
						onSuccess : function(respObj) {
							var userList = respObj.RSP_BODY.userList;
							var crediterList = respObj.RSP_BODY.crediterList;
							var approverList = respObj.RSP_BODY.approverList;
							if (id == '1') {
								result+="<form>";
								result+="<table id='allotTable' >";
								result+="<tr><td><input type='checkbox' id='all' name='all' onclick='selectAll(1)' /> 全选</td></tr>"; 
								for (var i = 0; i < userList.length; i++) {
									result += "<tr>";
									result += " <td><input type='checkbox' onclick='selectOne(1)' value='"+userList[i].userCode+"' name='queueorgroup' /> "
											+ userList[i].userName+'已分配件为'+userList[i].userNum + "</td>";
									result += "<td><input type='text' oninput='fnJiSuan(1)' name='appNum'  id='"+userList[i].userCode+"'/>件</td>";
									result += "</tr>";
								}
								result+="</table>";
								result+="</form>";
							} else if (id == '2') {
								result+="<table id='allotTable2' >";
								result+="<tr><td><input type='checkbox' id='all2' name='all2' onclick='selectAll(2)' /> 全选</td></tr>";
								for (var i = 0; i < userList.length; i++) {
									result += "<tr>";
									result += " <td><input type='checkbox' onclick='selectOne(2)'  value='"+userList[i].userCode+'2'+"' name='queueorgroup2'/> "
											+ userList[i].userName +'已分配件为'+userList[i].userNum+ "</td>";
									result += "<td><input type='text' class='easyui-textbox' name='appNum2'  id='"+userList[i].userCode+'2'+"'/>%</td>";
									result += "</tr>";
								}
								result+="</table>";
							} else if (id == '3') {
								result+="<table id='allotTable3' >";
								result += "<tr>";
								result += " <td>流水号<input type='text' id='appId'  class='easyui-textbox'> </td>";
								result += "</tr>";
								result += "<tr>";
								result += " <td>分配至<select id='combox_2_level' class='easyui-combobox' style='width:400px;'><option value='-1'>请选择</option>";
								for (var i = 0; i < userList.length; i++) {
									result += "<option value='"+userList[i].userCode+"'>"
											+ userList[i].userName+'已分配件为'+userList[i].userNum
											+ "</option>";
								}
								result += "</select></td>";
								result += "</tr>";
								result+="</table>";
							}else if(id == '4'){
								result+="<table id='allotTable4'>";
								result += "<tr>";
								result += " <td>征信: <select id='combox_3_level' style='width: 180px;'  class='easyui-combobox'><option value='-1'>请选择</option>";
								for (var i = 0; i < crediterList.length; i++) {
									result += "<option value='"+crediterList[i].userCode+"'>"
											+ crediterList[i].userName+'-待分配未挂起件为'+ crediterList[i].userNum2
											+ "</option>";
								}
								result += "</select></td>";
								result += " <td>审批: <select id='combox_4_level' style='width: 180px;'  class='easyui-combobox'><option value='-1'>请选择</option>";
								for (var i = 0; i < approverList.length; i++) {
									result += "<option value='"+approverList[i].userCode+"'>"
											+ approverList[i].userName+'-未完成件为'+ approverList[i].userNum
											+ "</option>";
								}
								result += "</select></td>";
								result += "<td>特定分配数：<input  name='allotNum' id='allotNum' type='text' /></td> ";
								result += "</tr>";
								result+="</table>";
							}
							$('#area_2_level_' + id).html(result);
							$('#area_2_level_' + id).removeClass('display');
						}
					});
		}
		//按申请件个数、比例、申请件编号分配
		function fnAllot() {
			//首先判断查询条件是否为已分配或挂起状态 
			var appStatus=$("#appStatus").combobox('getValue');
			if(appStatus=='2'){
				$.messager.alert("提示","目前查询条件已分配被选中,请去掉  ");
				return;
			}
			var appStatus2=document.getElementsByName('appStatus2');
			if(appStatus2[0].checked){
				$.messager.alert("提示","目前查询条件挂起标签被选中,请去掉  ");
				return;
			};
			//首先判断是否分件进行中  如果进行中  提示稍等片刻
			var  allotFlag=$("#allotFlag").val();
			if(allotFlag=='1'){
				$.messager.alert("提示","目前正分件处理中,不要频繁点击,亲请先休息小会儿... ");
				return;
			}else{//未处于分件中   赋值 正在分件
				$("#allotFlag").val("1");
			}
			var num= $('#info_query').text();
			var id = $("input[name='hiddenId']").val();
			if(id==null||id==""||id=="-1"){
				$("#allotFlag").val("0");
				$.messager.alert("操作提示","分配类型必须选择 ","error");
				return;
			}
			var seachForm = $("#seachForm");
			var jsondata = getFormMulData(seachForm.serializeArray());
			//分件 组员和 分配件数 
			var queueInfo = "";
			var appId = "";
			var a=0;
			if (id == '1'||id== '2') {
				//输入框集合 
				var appNums='';
				//复选框集合  
				var obj='';
				if(id=='1'){
					appNums=document.getElementsByName("appNum");
					obj=document.getElementsByName("queueorgroup");
					for(var k=0;k<obj.length;k++){
						var appNum=$(appNums[k]).val();
						//有值但未被选中 
						if(appNum!=null&&appNum!=""){
							if(obj[k].checked!=true){
								$("#allotFlag").val("0");
								$.messager.alert("操作提示",$(obj[k]).text()+"有输入值但未被勾选,请确定是否勾选或者去掉输入值  ","error");
								return;
							}
						}
						//校验选择是否有值  及把数据组装 
						if(obj[k].checked){
							var queue = $(obj[k]).val();
							var queueValue = $("#" + queue).val();
							if (queueValue == null || queueValue == "") {
								$("#allotFlag").val("0");
								 $.messager.alert("操作提示","勾选后必须输入值","error");
								return;
							} else {
								queueInfo += queue + ":" + queueValue + ";";
							}
							a++;
						}
					}
				}else if(id=='2'){
					appNums=document.getElementsByName("appNum2");
					obj=document.getElementsByName("queueorgroup2");
					//统计百分数
					var totalWeight=0;
					for(var k=0;k<obj.length;k++){
						var appNum=$(appNums[k]).val();
						//有值但未被选中 
						if(appNum!=null&&appNum!=""){
							if(obj[k].checked!=true){
								$("#allotFlag").val("0");
								$.messager.alert("操作提示",$(obj[k]).text()+"有输入值但未被勾选,请确定是否勾选或者去掉输入值  ","error");
								return;
							}
						}
						//校验选择是否有值  及把数据组装 
						if(obj[k].checked){
							var queue = $(obj[k]).val();
							var queueValue = $("#" + queue).val();
							totalWeight=totalWeight+parseInt(queueValue);
							if (queueValue == null || queueValue == "") {
								$("#allotFlag").val("0");
								 $.messager.alert("操作提示","勾选后必须输入值","error");
								return;
							} else {
								var a=queue.substring(0,queue.length-1);
								queueInfo += a + ":" +queueValue+ ";";
							}
							a++;
						}
					}
					if(totalWeight>100){
						$("#allotFlag").val("0");
						$.messager.alert("操作提示","采用百分比分配时输入值总和大于100","error");
						return;
					}
				}
				if(a==0){
					$("#allotFlag").val("0");
					$.messager.alert("操作提示","要分配到的组员必须选择  ","error");
					return;
				}
				$cf.ajax({
					url : "/opas-allot-server/handQueueOrGroup.json",
					data : {
						'jsondata' : jsondata,
						'queueInfo' : queueInfo,
						'id' : id,
						'userCode':userCode,
						'ydjFlag':'1',
						'secondNode':secondNode,
						'node':node
					},
					onSuccess : function(respObj) {
						if (respObj.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "分配成功 ! ", "info", function() {
								//已分配
								var count = respObj.RSP_BODY.allotTotal;
								$('#info_alloted').text(count);
								fnGetCount();
								//剩余件
								//var countAppId = $(".countAppId").text();
								var countAppId =$("#jiSuan").val();
								var rest=countAppId-count;
								$('#info_remainder').text(rest);
								//查询结果剩余
								fnQuery();
								//初始化
								fnInitShow();
								$('#allot_type').combobox("setValue",'--请选择--'); 
								//分件成功与否  都将分件标识重置  为下次分件做准备
								$("#allotFlag").val("0");
							});
						} else {
							$.messager.alert("操作提示", "分配异常,原因:  " + respObj.RSP_BODY.exMsg, "error");
							fnGetCount();
							//查询结果剩余
							fnQuery();
							fnInitShow();
							$('#allot_type').combobox("setValue",'--请选择--'); 
							//分件成功与否  都将分件标识重置  为下次分件做准备
							$("#allotFlag").val("0");
							return;
						}
						
					}
				});
			}else if (id == '3') {
				var appId = $("#appId").val();
				if (appId == '' || appId == null) {
					$("#allotFlag").val("0");
					$.messager.alert("操作提示","流水号为空 ","error");
					return;
				} 
				var code = $("#combox_2_level  option:selected").val();
				if (code == '-1' || code == ''|| code == null) {
					$("#allotFlag").val("0");
					$.messager.alert("操作提示","组员未选择 ","error");
					return;
				} 
				$cf.ajax({
					url : "/opas-allot-server/handQueueOrGroup.json",
					data : {
						'jsondata' : jsondata,
						'queueInfo' : queueInfo,
						'id' : id,
						'appId' : appId,
						'code' : code,
						'userCode':userCode,
						'ydjFlag':'1',
						'secondNode':secondNode,
						'node':node
					},
					onSuccess : function(respObj) {
						if (respObj.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "分配成功 ! ", "info", function() {
								//已分配
								var count = respObj.RSP_BODY.allotTotal;
								$('#info_alloted').text(count);
								fnGetCount();
								//剩余件
								//var countAppId = $(".countAppId").text();
								var countAppId =$("#jiSuan").val();
								var rest=countAppId-count;
								$('#info_remainder').text(rest);
								//查询结果剩余
								fnQuery();
								//初始化
								fnInitShow();
								$('#allot_type').combobox("setValue",'--请选择--'); 
								//分件成功与否  都将分件标识重置  为下次分件做准备
								$("#allotFlag").val("0");
							});
						} else {
							$.messager.alert("操作提示", "分配异常,原因: " + respObj.RSP_BODY.exMsg, "error");
							fnGetCount();
							//查询结果剩余
							fnQuery();
							fnInitShow();
							$('#allot_type').combobox("setValue",'--请选择--'); 
							//分件成功与否  都将分件标识重置  为下次分件做准备
							$("#allotFlag").val("0");
							return;
						}
						
					}
				});
			}else if(id == '4'){
				//待分配审批池征信人员码
				var crediterCode = $("#combox_3_level  option:selected").val();
				if (crediterCode == '' || crediterCode == null ||crediterCode=='-1') {
					$("#allotFlag").val("0");
					$.messager.alert("操作提示","征信人员未选择 ","error");
					return;
				} 
				//要待分配审批池内征信人员申请件 
				var allNum=$("#combox_3_level  option:selected").text().split("为")[1];
				if (parseInt(allNum) == 0) {
					$("#allotFlag").val("0");
					$.messager.alert("操作提示","征信人员待分配申请件为0","error");
					return;
				} 
				//审批人员码
				var approvalCode=$("#combox_4_level  option:selected").val(); 
				if (approvalCode == '' || approvalCode == null ||approvalCode =='-1') {
					$("#allotFlag").val("0");
					$.messager.alert("操作提示","审批人员未选择 ","error");
					return;
				} 
				//本次分配申请件数量
				var approvalNum=$("#allotNum").val();
				if(parseInt(allNum)<parseInt(approvalNum)){
					$("#allotFlag").val("0");
					$.messager.alert("操作提示","要分配的总件数不能大于当前征信人员的待分配总申请件 ","error");
					return;
				}
				$cf.ajax({
					url : "/opas-allot-server/handQueueOrGroup.json",
					data : {
						'id' : id,
						'crediterCode' : crediterCode,
						'approvalCode' : approvalCode,
						'approvalNum':approvalNum,
						'userCode':userCode,
						'ydjFlag':'1',
						'secondNode':'3',
						'node':'03'
					},
					onSuccess : function(respObj) {
						if (respObj.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "分配成功 ! ", "info", function() {
								//已分配
								var count = respObj.RSP_BODY.allotTotal;
								$('#info_alloted').text(count);
								fnGetCount();
								//剩余件
								//var countAppId = $(".countAppId").text();
								var countAppId =$("#jiSuan").val();
								var rest=countAppId-count;
								$('#info_remainder').text(rest);
								//查询结果剩余
								fnQuery();
								//初始化
								fnInitShow();
								$('#allot_type').combobox("setValue",'--请选择--');
								//分件成功与否  都将分件标识重置  为下次分件做准备
								$("#allotFlag").val("0");
							});
						} else {
							$.messager.alert("操作提示", "分配异常,原因:  " + respObj.RSP_BODY.exMsg, "error");
							fnGetCount();
							//查询结果剩余
							fnQuery();
							fnInitShow();
							$('#allot_type').combobox("setValue",'--请选择--'); 
							//分件成功与否  都将分件标识重置  为下次分件做准备
							$("#allotFlag").val("0");
							return;
						}
					}
				});
			}
			
		}
	
		//转移 情况  
		function fnShowTransferById(id) {
			$("input[name='transferId']").val(id);
			fnInitTransfer();
			var result = '';
			if(id==1||id==2){
				$cf.ajax({
					url : "/opas-allot-server/showAllotUser.json",
					data:{'node':node,
						'ydjFlag':'1',
						'secondNode':'3',
						"orgLevel":'5',
						'userCode':userCode,
						'isHangUp':'1'//added by jipengchun
						},
					onSuccess : function(respObj) {
						var userList = respObj.RSP_BODY.userList;
						if (id == '1') {
							result+="<table>";
							result += "<tr>";
							result += " <td>转移组员员工号  <select id='id_tree_type' name='tree_type' class='easyui-combobox' style='width:320px;' ><option value='-1'>请选择</option>";
							for (var i = 0; i < userList.length; i++) {
								result += "<option value='"+userList[i].userCode+"'>"
										+ userList[i].userName+'已分配未挂起件为'+userList[i].userNum
										+ "</option>";
							}
							result += "</select></td>";	
							result += "<td><input type='button' value='查询' style='width:100px;' onClick='fnChaXun(5)'/>&nbsp;&nbsp;可分配：<strong id='chaXunId5'></strong>件</td>";
							result += "<td align=\"center\">转移队列";
							result += "</td>";
							result += "<td><select id='queue_tree_type' name='tree_type' class='easyui-combobox' style='width:320px;'>";
							result += "<option value='-1' currStatusStr='' delStatusStr=''>请选择</option>";
							result += "<option value='wwc' currStatusStr='3' delStatusStr='0'>未完成队列</option>";
							result += "<option value='dbj' currStatusStr='3' delStatusStr='2'>待补件队列</option>";
							result += "<option value='ygq' currStatusStr='4' delStatusStr=''>已挂起队列</option>";
							result += "</td>";
							result += "</tr>";
							result += "<tr><td>";
							result += "<a href='javascript:void(0)' class='easyui-linkbutton' onclick='onCheckNow(5)'>当日新接收的申请件</a>";
							result += "：<strong id='info_todayApp5'>0</strong>件";
							result += "<input type='checkbox' name='todayTransferApp' id='todayTransferApp' /> 转移当日新接收的申请件标识  ";
							result += "</td>";
							result += "</tr>";
							result += "<tr><td>接收组员:</td></tr>";
							result+="<tr><td><input type='checkbox' id='all3' name='all3' onclick='selectAll(3)' /> 全选</td></tr>";
							for (var i = 0; i < userList.length; i++) {
								result += "<tr>";
								result += " <td><input type='checkbox' onclick='selectOne(3)' value='"+userList[i].userCode+'4'+"' name='acceptUser'/> "
										+ userList[i].userName +'已分配未挂起件为'+userList[i].userNum+ "</td>";
								result += "<td><input type='text' class='easyui-textbox' id='"+userList[i].userCode+'4'+ "'/>件</td>";
								result += "</tr>";
							}
							result+="</table>";
						}  else if (id == '2') {
							result+="<table>";
							result += "<tr>";
							result += " <td>流水号<input type='text' id='appId2'  class='easyui-textbox'> </td>";
							result += "</tr>";
							result += "<tr>";
							result += " <td>转移至 <select id='combox_transfer_level' class='easyui-combobox' style='width:320px;'><option value='-1'>请选择</option>";
							for (var i = 0; i < userList.length; i++) {
								result += "<option value='"+userList[i].userCode+"'>"
										+ userList[i].userName+'已分配未挂起件为'+userList[i].userNum
										+ "</option>";
							}
							result += "</select></td>";
							result += "</tr>";
							result+="</table>";
						}
						$('#area_transfer_level_' + id).html(result);
						$('#area_transfer_level_' + id).removeClass('display');
					}
				});
			}else if(id==3||id==4){
				$cf.ajax({
					url : "/opas-allot-server/showAllotGroup.json",
					data:{'node':node,
						"orgLevel": '5' ,
						'secondNode':'3',
						'ydjFlag':'1',
						'userCode':userCode,
						'isHangUp':'1'
						},
					onSuccess : function(respObj) {
						var groupList = respObj.RSP_BODY.groupList;
						var orgName = respObj.RSP_BODY.orgName;
						var currGroupNum = respObj.RSP_BODY.currGroupNum;
						$("#hideGroupNum").val(currGroupNum);
						if (id == '3') {
							result+="<table>";
							result += "<tr>";
							result += " <td>转移组:&nbsp;&nbsp;"+orgName+"-待转移申请件为"+currGroupNum+"个</td> ";
							result += "<td><input type='button' value='查询' style='width:100px;' onClick='fnChaXun(6)'/>&nbsp;&nbsp;可分配：<strong id='chaXunId6'></strong>件</td>";
							result += "</tr>";						
							result += "<tr><td>";
							result += "<a href='javascript:void(0)' class='easyui-linkbutton' onclick='onCheckNow(6)'>当日新接收的申请件</a>";
							result += "：<strong id='info_todayApp6'>0</strong>件";
							result += "<input type='checkbox' name='todayTransferApp' id='todayTransferApp2' /> 转移当日新接收的申请件标识  ";
							result += "</td>";
							result += "</tr>";
							result += "<tr><td>接收组:</td></tr>";
							result+="<tr><td><input type='checkbox' id='all4' name='all4' onclick='selectAll(4)' /> 全选</td></tr>";
							for (var i = 0; i < groupList.length; i++) {
									result += "<tr>";
									result += " <td><input type='checkbox' onclick='selectOne(4)'  value='"+groupList[i].orgNo+"' name='acceptGroup'/> "
											+ groupList[i].orgName +'-待分配未挂起件为'+ groupList[i].orgNum + "</td>";
									result += "<td><input type='text' class='easyui-textbox' id='"+groupList[i].orgNo+"'/>件</td>";
									result += "</tr>";
							}
							result+="</table>";
						}  else if (id == '4') {
							result+="<table>";
							result += "<tr>";
							result += " <td>流水号<input type='text' id='appId3'  class='easyui-textbox'> </td>";
							result += "</tr>";
							result += "<tr>";
							result += " <td>转移至 <select id='combox_transfer_level2' class='easyui-combobox' style='width:320px;'><option value='-1'>请选择</option>";
							for (var i = 0; i < groupList.length; i++) {
								result += "<option value='"+groupList[i].orgNo+"'>"
										+ groupList[i].orgName+'-待分配未挂起件为'+ groupList[i].orgNum 
										+ "</option>";
							}
							result += "</select></td>";
							result += "</tr>";
							result+="</table>";
						}
						$('#area_transfer_level_' + id).html(result);
						$('#area_transfer_level_' + id).removeClass('display');
					}
				});
			}
			
		}
		function fnTransfer() {
			var id = $("input[name='transferId']").val();
			if(id==null||id==""||id=="-1"){
				$.messager.alert("操作提示","转移类型必须选择  ","error");
				return;
			}
			var appId = '';
			var currCode='';
			var obj='';
			var a=0;
			var transferType='';
			//要转走的申请件总和 
			var tranSum=0;
			//要转移的组员或组申请件  
			var allNum=0;
			if (id == '1'|| id=='3') { 
				var seachForm = $("#seachForm");
				var jsondata = getFormMulData(seachForm.serializeArray());
				var queueInfo='';
// 				var queueCode="";
				if(id=='1'){
					if(document.getElementById("todayTransferApp").checked){
						transferType='1';//选中
					}else{
						transferType='0';//未选中
					}
				}else if(id=='3'){
					if(document.getElementById("todayTransferApp2").checked){
						transferType='1';//选中
					}else{
						transferType='0';//未选中
					}
				}
				if(id=='1'){
					currCode = $("#id_tree_type  option:selected").val(); 
					//要转移的组员申请件  
					allNum=$("#id_tree_type  option:selected").text().split("为")[1];
					if (currCode == '' ||currCode == null ||currCode=='-1') {
						$.messager.alert("操作提示","转移组员为空","error");
						return;
					}
					obj=document.getElementsByName("acceptUser");
					for(var k=0;k<obj.length;k++){
						if(obj[k].checked){
							var queue = $(obj[k]).val();
							var ab=queue.substring(0,queue.length-1);
							if(ab==currCode){
								 $.messager.alert("操作提示","转移组员同时被选为接收组员,应去掉!","error");
								 return;
							}
							var queueValue = $("#" + queue).val();
							if (queueValue == null || queueValue == "") {
								 $.messager.alert("操作提示","勾选后必须输入值","error");
								return;
							} else {
								tranSum+=parseInt(queueValue);
								queueInfo += ab + ":" +queueValue+ ";";
							}
							a++;
						}
					}
					if(a==0){
						 $.messager.alert("操作提示","要转移到的组员必须选择  ","error");
						return;
					}
					if(parseInt(allNum)<parseInt(tranSum)){
						$.messager.alert("操作提示","要转移的总件数不能大于当前转移组员的总申请件 ","error");
						return;
					}
				}else if(id=='3'){
					obj=document.getElementsByName("acceptGroup");
					for(var k=0;k<obj.length;k++){
						if(obj[k].checked){
							var queue = $(obj[k]).val();
							var queueValue = $("#" + queue).val();
							if (queueValue == null || queueValue == "") {
								 $.messager.alert("操作提示","勾选后必须输入值","error");
								return;
							} else {
								tranSum+=parseInt(queueValue);
								queueInfo += queue + ":" + queueValue + ";";
							}
							a++;
						}
					}
					if(a==0){
						$.messager.alert("操作提示","要转移 到的组必须选择 ","error");
						return;
					}
					allNum=$("#hideGroupNum").val();
					if(allNum<tranSum){
						$.messager.alert("操作提示","要转移的总件数不能大于当前转移组的总申请件 ","error");
						return;
					}
				}
				
				$cf.ajax({
					url : "/opas-allot-server/transferApply.json",
					data : {
						'id' : id,
						'currCode' : currCode,
						'userCode':userCode,
						'transferType' : transferType,
						'queueInfo' : queueInfo,
						'secondNode':secondNode,
						'ydjFlag':'1',
						'node':node,
						'jsondata':jsondata,
						'currStatusStr':$("#queue_tree_type option:selected").attr('currStatusStr'),
						'delStatusStr':$("#queue_tree_type option:selected").attr('delStatusStr')
					},
					onSuccess : function(data) {
						if (data.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "转移成功 ! ", "info", function() {
								fnInitTransfer();
								fnQuery();
								$('#allot_transfer').combobox("setValue",'--请选择--');
								
							});
						} else {
							$.messager.alert("操作提示", "转移 异常,原因: " + data.RSP_BODY.exMsg, "error");
							fnInitTransfer();
							fnQuery();
							$('#allot_transfer').combobox("setValue",'--请选择--');
							return;
						}
					}
				});
			}else if (id == '2'|| id== '4') {
				if(id=='2'){
					appId = $("#appId2").val();
					if (appId == '' || appId == null ) {
						$.messager.alert("操作提示","流水号为空","error");
						return;
					} 
					currCode = $("#combox_transfer_level  option:selected").val();
					if (currCode == '' || currCode == null||currCode=='-1') {
						$.messager.alert("操作提示","未选择要转移件到的组员 ","error");
						return;
					}
				}else if(id=='4'){
					appId = $("#appId3").val();
					if (appId == ''|| appId == null ) {
						$.messager.alert("操作提示","流水号为空","error");
						return;
					} 
					currCode = $("#combox_transfer_level2  option:selected").val();
					if (currCode == '' ||currCode == null|| currCode=='-1') {
						$.messager.alert("操作提示","未选择要转移件到的组 ","error");
						return;
					}
				}
				$cf.ajax({
					url : "/opas-allot-server/transferApply.json",
					data : {
						'id' : id,
						'appId' : appId,
						'currCode' : currCode,
						'userCode':userCode,
						'secondNode':secondNode,
						'ydjFlag':'1',
						'node':node
					},
					onSuccess : function(data) {
						if (data.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "转移成功 ! ", "info", function() {
								fnInitTransfer();
								fnQuery();
								$('#allot_transfer').combobox("setValue",'--请选择--'); 
							});
						} else {
							$.messager.alert("操作提示", "转移 异常,原因: " + data.RSP_BODY.exMsg, "error");
							fnInitTransfer();
							fnQuery();
							$('#allot_transfer').combobox("setValue",'--请选择--'); 
							return;
						}
					}
				});
			}
			
		}
	//回收
	function fnShowRecoveryById(id) {
			$("input[name='recoveryId']").val(id);
			fnInitRecovery();
			var result = '';
			$cf.ajax({
						url : "/opas-allot-server/showAllotUser.json",
						data:{'node':node,
							'ydjFlag':'1',
							"orgLevel":'5',
							'userCode':userCode
							},
						onSuccess : function(respObj) {
								var userList = respObj.RSP_BODY.userList;
								if (id == '1') {
									result+="<table>";
									result += "<tr>";
									result += " <td>回收组员员工号 <select id='id_recovery_type' class='easyui-combobox' style='width:320px;' ><option value='-1'>请选择</option>";
									for (var i = 0; i < userList.length; i++) {
										result += "<option value='"+userList[i].userCode+"'>"
												+ userList[i].userName+'已分配未挂起件为'+userList[i].userNum
												+ "</option>";
									}
									result += "</select>";
									result += "<input type='button' value='查询' style='width:100px;' onClick='fnChaXun(7)'/>&nbsp;&nbsp;可分配：<strong id='chaXunId7'></strong>件&nbsp;&nbsp;";
									result += "<a href='javascript:void(0)' class='easyui-linkbutton' onclick='onCheckNow(7)'>当日新接收的申请件</a>";
									result += "：<strong id='info_todayApp7'>0</strong>件";
									result += "<input type='checkbox' name='todayRecoveryApp' id='todayRecoveryApp' onclick='onFuZhi(7)' />回收当日新接收的申请件标识 ";
									result += "回收件数：<input  name='recoveryNum' id='recoveryNum' type='text' /> ";
									result += "回收节点  <select id='recoveryNode' class='easyui-combobox'><option value='-1'>请选择</option>";
									result += "<option value='1'>待分配池</option><option value='3'>待分配组</option>";	
									result += "</select>";	
									result += "回收队列：<select id='recoveryQueue' class='easyui-combobox'>";
									result += "<option value='-1' currStatusStr='' delStatusStr=''>请选择</option>";
									result += "<option value='wwc' currStatusStr='3' delStatusStr='0'>未完成队列</option>";
									result += "<option value='dbj' currStatusStr='3' delStatusStr='2'>待补件队列</option>";
									result += "</td>";
									result += "</tr>";
									result+="</table>";
								} else if (id == '2') {
									result+="<table>";
									result += "<tr>";
									result += " <td>流水号<input type='text' id='appId4'  class='easyui-textbox'> </td>";
									result += "</tr>";
									result += "<tr>";
									result += " <td>回收节点 <select id='recoveryNode2' class='easyui-combobox'><option value='-1'>请选择</option>";
									result += "<option value='1'>待分配池</option><option value='3'>待分配组</option>";	
									result += "</select></td>";
									result += "</tr>";
									result+="</table>";
								}
								$('#area_recovery_level_' + id).html(result);
								$('#area_recovery_level_' + id).removeClass('display');
							}
						});
		}
		function fnRecovery() {
			var id=$("input[name='recoveryId']").val();
			if(id==null||id==""||id=="-1"){
				$.messager.alert("操作提示","回收类型必须选择   ","error");
				return;
			}
			var recoveryType='';
			var allNum=0;
			if (id == '1') {
				var seachForm = $("#seachForm");
				var jsondata = getFormMulData(seachForm.serializeArray());
				var currCode = $("#id_recovery_type  option:selected").val();
				//要回收的组申请件 
				allNum=$("#id_recovery_type  option:selected").text().split("为")[1];
				if (currCode == ''||currCode == null||currCode == '-1') {
					$.messager.alert("操作提示","回收组员未选择   ","error");
					return;
				} 
				if(document.getElementById("todayRecoveryApp").checked){
					recoveryType='1';//选中
				}else{
					recoveryType='0';//未选中
				}
				var recoveryNum=$("#recoveryNum").val();
				if (recoveryNum == ''|| recoveryNum == null) {
					$.messager.alert("操作提示","回收件数为空  ","error");
					return;
				}
				var recoveryNode = $("#recoveryNode  option:selected").val();
				if (recoveryNode == '' ||recoveryNode == null ||recoveryNode == '-1') {
					$.messager.alert("操作提示","回收节点为空   ","error");
					return;
				}
				if(parseInt(allNum)<parseInt(recoveryNum)){
					$.messager.alert("操作提示","要回收的总件数不能大于当前回收组员的总申请件  ","error");
					return;
				}
				$cf.ajax({
					url : "/opas-allot-server/recoveryApply.json",
					data : {
						'id':id,
						'currCode' : currCode,
						'recoveryType' : recoveryType,
						'recoveryNum' : recoveryNum,
						'node':node,
						'secondNode':secondNode,
						'ydjFlag':'1',
						'userCode':userCode,
						'recoveryNode':recoveryNode,
						'jsondata':jsondata,
						'currStatusStr':$("#recoveryQueue option:selected").attr('currStatusStr'),
						'delStatusStr':$("#recoveryQueue option:selected").attr('delStatusStr')
					},
					onSuccess : function(data) {
						if (data.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "回收成功 !", "info", function() {
								fnInitRecovery();
								fnQuery();
								$('#allot_recovery').combobox("setValue",'--请选择--'); 
							});
						} else {
							$.messager.alert("操作提示", "回收异常,原因: " + data.RSP_BODY.exMsg, "error");
							fnInitRecovery();
							fnQuery();
							$('#allot_recovery').combobox("setValue",'--请选择--'); 
							return;
						}
					}
				});
			}else if (id == '2') {
				var appId = $("#appId4").val();
				if (appId == '' || appId == null ) {
					$.messager.alert("操作提示","流水号为空 ","error");
					return;
				}
				var recoveryNode = $("#recoveryNode2  option:selected").val();
				if (recoveryNode == ''|| recoveryNode == null||recoveryNode=="-1") {
					$.messager.alert("操作提示","回收节点未选择  ","error");
					return;
				} 
				$cf.ajax({
					url : "/opas-allot-server/recoveryApply.json",
					data : {
						'id':id,
						'appId':appId,
						'node':node,
						'secondNode':secondNode,
						'ydjFlag':'1',
						'userCode':userCode,
						'recoveryNode':recoveryNode
					},
					onSuccess : function(data) {
						if (data.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "回收成功 !", "info", function() {
								fnQuery();
								fnInitRecovery();
								$('#allot_recovery').combobox("setValue",'--请选择--'); 
							});
						} else {
							$.messager.alert("操作提示", "回收异常,原因: " + data.RSP_BODY.exMsg, "error");
							fnInitRecovery();
							fnQuery();
							$('#allot_recovery').combobox("setValue",'--请选择--'); 
							return;
						}
					}
				});
			}
		}
		
		function onFuZhi(value){
			onCheckNow(value);
			var count="";
			if(value==7){
				count=$('#info_todayApp7').text();
			}
			$("input[name='recoveryNum']").val(count);
		} 
		
		//当日新接收  待转移或回收申请件 
		function onCheckNow(value){
			var seachForm = $("#seachForm");
			var jsondata = getFormMulData(seachForm.serializeArray());
			var curr='',currCode='',id ='',isHangUp='';
			if(value==5){
				isHangUp='1';
				id = $("input[name='transferId']").val();
				currCode = $("#id_tree_type  option:selected").val(); 
				if (currCode == null || currCode == ""|| currCode == "-1") {
					 $.messager.alert("操作提示","要被转移件的组员 必须被选中 ","error");
					return;
				}
			}else if(value==6){// 当前组的件
				isHangUp='1';
				id = $("input[name='transferId']").val();
			}else if(value==7){
				 id=$("input[name='recoveryId']").val();
				 currCode = $("#id_recovery_type  option:selected").val();
				if (currCode == null || currCode == ""|| currCode == "-1") {
					 $.messager.alert("操作提示","要被回收件的组员必须被选中 ","error");
					return;
				} 
			}
			if(isHangUp=='1'){
				jsondata.isHangUp=isHangUp;
			}
			$cf.ajax({
				url : "/opas-allot-server/countTodayApp.json",
				data:{
					'value':value,
					'id':id,
					'node':node,
					'secondNode':secondNode,
					'currCode':currCode,
					'ydjFlag':'1',
					'userCode':userCode,
					'jsondata':jsondata
					},
				onSuccess : function(data) {
					var count = data.RSP_BODY.total;
					if(value==5){
						$('#info_todayApp5').text(count);
					}else if(value==6){
						$('#info_todayApp6').text(count);
					}else if(value==7){
						$('#info_todayApp7').text(count);
					}
				}
			});
		}
		
		function fnReset(){
			var id=$("input[name='hiddenId']").val();
			if(id==1){
				$("#allotTable tr td input[type=text]").val("");
				var checklist=document.getElementsByName("queueorgroup");
				for(var j=0;j<checklist.length;j++){
					checklist[j].checked=0;
				}
				document.getElementById("all").checked=0;
			}else if(id==2){
				$("#allotTable2 tr td input[type=text]").val("");
				var checklist=document.getElementsByName("queueorgroup2");
				for(var j=0;j<checklist.length;j++){
					checklist[j].checked=0;
				}
				document.getElementById("all2").checked=0;
			}else if(id==3){
				document.getElementById("combox_2_level").value='-1';
				$("#allotTable3 tr td input[type=text]").val("");
			}else if(id==4){
				document.getElementById("combox_3_level").value='-1';
				document.getElementById("combox_4_level").value='-1';
				$("#allotTable4 tr td input[type=text]").val("");
			}
			//如果重置  重新计算待分配件和已分配件  剩余件
			fnJiSuan('1');
		}
	</script>
</body>
</html>