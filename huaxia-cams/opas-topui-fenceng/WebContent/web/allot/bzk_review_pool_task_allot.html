<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" content="ie=edge"/>
<meta charset="UTF-8" />
<title>池任务分配</title>
<link href="../../css/normalize.css" type="text/css" rel="stylesheet" />
<link href="../../css/normalize-ext.css" type="text/css" rel="stylesheet" />
<script src="../../topui/topui.js" type="text/javascript"></script>
<script src="../../topui/easyui/default/easyuiExt.js" type="text/javascript"></script>
<script src="../../js/author/common.js" type="text/javascript"></script>
<script type="text/javascript" src="../../js/common/json2.js"></script>
<script src="../../js/author/allot.js" type="text/javascript"></script>
<METAHTIP-EQUIV="Pargma" CONTENT="no-cache">
<METAHTTP-EQUIV="Cache-Control" CONTENT="no-cache">
<METAHTTP-EQUIV="Expires" CONTENT="0">
<style type="text/css">
.area-tips {
	padding: 10px;
	text-align: right;
}

.area-function {
	text-align: center;
}

.area-function a {
	width: 50px;
}
.area-2-level {
	background-color: #F0F0F0;
}

.divHeight{
	_height:50px;
	min-height:50px;
	height:auto;
}

.divHeight2{
	_height:240px;
	min-height:240px;
	height:auto;
}

.area-transfer-level{
	background-color: #F0F0F0;
}

.area-recovery-level{
	background-color: #F0F0F0;
}
</style>
</head>
<body  style="padding:10px;">
<div  id="main_layout" style="width:98%;scroll:true;"> 
	<h1>池任务分配</h1>
	<fieldset>
		<legend>筛选条件</legend>
		<div class="area-tips">
			待分配：<em class="countAppId"></em>件 / 快速审批件数量：<em class="quickAppId"></em>件
			/ 查询结果：<strong id="info_query">0</strong>件
		</div>
		<div align="center">
			<form id="seachForm" method="post" accept-charset="UTF-8">
				<table>
					<tr>
						<td>流水号字母：</td>
						<td><select class="easyui-combobox" id="serialNum" name="serialNum"
							dict_type="ALLOT_SERIALNUM" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>展业地区：</td>
						<td><select class="easyui-combobox" name="appRegion" dict_type="ALLOT_APPREGION"
							editable="false"  id="appRegion" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>渠道：</td>
						<td><select class="easyui-combobox" name="appChannel" id="appChannel"
							dict_type="ALLOT_APPCHANNEL" editable="false"  multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
					</tr>
					<tr>
						<td>录入商：</td>
						<td><select class="easyui-combobox" name="appInput" id="appInput" 
							dict_type="ALLOT_APPINPUT" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;" multiple="true">
						</select></td>
						<td>卡产品类型：</td>
						<td><select class="easyui-combobox" data-options="valueField:'cardCode',textField:'prodName'"
									style="width: 150px" name="appProd" id="appProd" multiple="true">
							</select></td>
						<td>时间：</td>
						<td>
						<select class="easyui-combobox" name="shareTime"
							dict_type="ALLOT_SHARETIME" editable="false" id="shareTime"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<span>
							<input class="easyui-datebox" name="appTimeStart"  id="appTimeStart" style="width: 150px;"/>
							<input class="easyui-datebox" name="appTimeEnd"  id="appTimeEnd" style="width: 150px;"/>
							<input class="easyui-datebox" name="crtTimeStart"  id="crtTimeStart" style="width: 150px;"/>
							<input class="easyui-datebox" name="crtTimeEnd"  id="crtTimeEnd" style="width: 150px;"/>
						</span>
						</td>
					</tr>
					<tr>
						<td>异常进件渠道：</td>
						<td><select class="easyui-combobox" name="nosafePromoter" dict_type="ALLOT_NO_SAFE"
							editable="false" id="nosafePromoter"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
						<td>单位名称：</td>
						<td><input class="easyui-textbox" name="c1CoName"  id="c1CoName" 
							style="width: 150px;"></td>
						<td>邮寄地址：</td>
						<td>
						<select class="easyui-combobox" name="c4CyCadd1" 
							dict_type="ALLOT_CARDTO1" editable="false" id="c4CyCadd1"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
					</tr>
					<tr>
						<td>团办号：</td>
						<td><input class="easyui-textbox" name="c4ApBatch"  id="c4ApBatch"
							 style="width: 96px;" />
							<a href="javascript:fnBatch();" 
							class="easyui-linkbutton" style="width: 50px;">查询</a></td>
						<td>项目号（专案代码）：</td><!-- added by jpc -->
						<td><input class="easyui-textbox" name="c5JcType"  id="c5JcType"
							 style="width: 96px;" />
							<a href="javascript:fnJCType();" 
							class="easyui-linkbutton" style="width: 50px;">查询</a></td>
					</tr>
					<tr>
						<td>推广机构号：</td>
						<td><input class="easyui-textbox" name="c5AbCode" id="c5AbCode" 
							 style="width: 96px;" />
							<a href="javascript:fnAbCode();"
							class="easyui-linkbutton" style="width: 50px;">查询</a></td>
						<td>推广人员代码：</td>
						<td><input class="easyui-textbox" name="c4AbUser" id="c4AbUser"
							 style="width: 96px;" />
							<a href="javascript:fnAbUser();"
							class="easyui-linkbutton" style="width: 50px;">查询</a></td>
					</tr>
					<tr>
						<td>中征信1000评分：</td>
						<td><input class="easyui-textbox" name="minNumberRead" id="minNumberRead"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
							-<input class="easyui-textbox" id="maxNumberRead" name="maxNumberRead"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
						</td>
						<td>申请件状态：</td>
						<td><select class="easyui-combobox" name="appStatus" dict_type="ALLOT_CURRSTATUS"
							editable="false" id="appStatus"  
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>标识：</td>
						<td><select class="easyui-combobox" id="identify" name="identify" dict_type="ALLOT_IDENTIFY"
							editable="false"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<select class="easyui-combobox" 
							editable="false" id="child_1"  name="isHaveCardCust" dict_type="ALLOT_ISHAVECARD"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<select class="easyui-combobox" 
							editable="false" id="child_2"  name="quickCardFlag" dict_type="ALLOT_C4RUSHFLG"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<select class="easyui-combobox" 
							editable="false" id="child_3"  name="pubPolice" dict_type="ALLOT_PUBPOLICE"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width:  150px;">
						</select>
						</td>
					
					</tr>
					<tr>
						<td>征信策略结果描述：</td>
						<td>
							<select class="easyui-combobox" name="creditDecisionLayer" dict_type="ALLOT_BZK_CREDIT_DESCRIPTION"
							editable="false" id="creditDecisionLayer" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;" multiple="true">
						</select>
						</td>
						<td>征信策略结果：</td>
						<td>
						<select class="easyui-combobox" name="creditDecisionResult" dict_type="ALLOT_BZK_CREDIT"
							editable="false"  id="creditDecisionResult" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;" multiple="true">
						</select>
						</td>
					    <td>系统决策建议额度：</td>
						<td><input class="easyui-textbox" name="minProposedLmt"  id="minProposedLmt"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
							-<input class="easyui-textbox" name="maxProposedLmt"   id="maxProposedLmt"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
						</td>
					</tr>
					<tr>
						<td>分配顺序：</td>
						<td>
							<select class="easyui-combobox" name="allotType" dict_type="ALLOT_ALLOTTYPE"
							editable="false" id="allotType"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
							</select>
						</td>
						<td>腾讯天御分：</td>
						<td><input class="easyui-textbox" name="minRiskScore" id="minRiskScore"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
							-<input class="easyui-textbox"  id="maxRiskScore" name="maxRiskScore"
							 style="width: 73px;" data-options="validType:['number','maxLength[12]']"  >
						</td>
						<td>手机实名认证结果：</td>
						<td><select class="easyui-combobox" name="phoneCertification" 
							 id="phoneCertification" style="width: 150px;" 
							 dict_type="ALLOT_PHONE_NEW" editable="false" multiple="true"
							 data-options="valueField:'dictDetailCode',textField:'dictDetailName'" >
							 </select></td>
					</tr>
					<tr>
						<td>反欺诈决策结果：</td>
						<td><select class="easyui-combobox" id="fqzValue" name="fqzValue"
							dict_type="ALLOT_FQZ" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>天御风险码：</td>
						<td><select class="easyui-combobox" name="riskCode" dict_type="ALLOT_RISKCODE"
							editable="false"  id="riskCode" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
						<td>天御风险码等级：</td>
						<td><select class="easyui-combobox" name="riskLevel" id="riskLevel"
							dict_type="ALLOT_RISKLEVEL" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select></td>
					</tr>
					<tr>
						<td>网申渠道代码：</td>
						<td>
							<select class="easyui-combobox" data-options="valueField:'businessNumber',textField:'businessName'"
							style="width: 150px;" id="wsCode" name="wsCode"   multiple="true" >
							</select>
						</td>
						<td>授信决策结果：</td>
						<td>
						<select class="easyui-combobox"  dict_type="ALLOT_SXJCJG"
							editable="false"  id="decisionResult" name="decisionResult" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						</td>
						<td>客群标签：</td>
						<td>
						<select class="easyui-combobox"   dict_type="ALLOT_KQBQ"
							editable="false"  id="custFlag" name="custFlag" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						</td>
					</tr>
					<tr>
						<td>征信评分：</td>
						<td><input class="easyui-textbox" name="triggerType1" id="triggerType1"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
							-<input class="easyui-textbox" id="triggerType2" name="triggerType2"
							style="width: 73px;" data-options="validType:['number','maxLength[12]']" >
						</td>
						<td>预审结论：</td>
						<td>
						<select class="easyui-combobox" dict_type="YSJL"
							editable="false" id="approveResult"  name="approveResult" 
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						<select class="easyui-combobox"   dict_type="ALLOT_YSJL_CODE"
							editable="false"  id="resultInfo" name="resultInfo" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
						</select>
						</td>
					</tr>
					<tr>
						<td>标签：</td>
						<td colspan="3">
							<input type="checkbox" name="batchLabel" id="batchLabel" value="1" />批量&nbsp;&nbsp; 
							<input type="checkbox" name="pbocRstFinDesp" id="pbocRstFinDesp" value="1" />人行不良&nbsp;&nbsp;
							<input type="checkbox" name="appStatus2" id="appStatus2" value="24" />挂起 &nbsp;&nbsp;
						</td>
					</tr>
					<tr>
						<td>推荐来源：</td>
						<td><select class="easyui-combobox" name="rcdSrc" id="rcdSrc"
							dict_type="RCDSRC" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
						<td>平台类型：</td>
						<td><select class="easyui-combobox" name="platType" id="platType"
							dict_type="PLATTYPE" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
						<td>合作类型：</td>
						<td><select class="easyui-combobox" name="coprType" id="coprType"
							dict_type="COPRTYPE" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
					</tr>
					<tr>
						<td>平台风险层级：</td>
						<td><select class="easyui-combobox" name="platRiskLvl" id="platRiskLvl"
							dict_type="PLATRISKLVL" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
						<td>人像比对结果</td>
						<td>
							<select class="easyui-combobox" dict_type="ALLOT_RXBD"
							editable="false" id="policeRxbd"  name="policeRxbd" 
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;">
							</select>
						</td>
						<td>在网时长：</td>
						<td><select class="easyui-combobox" name="onlineTime" id="onlineTime"
							dict_type="ALLOT_ONLINE" editable="false" multiple="true"
							data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
							style="width: 150px;"></select></td>
					</tr>
				</table>
			</form>
		</div>
		<div class="area-function">
			<a href="javascript:fnQuery();" class="easyui-linkbutton" >查询</a>&nbsp;&nbsp;&nbsp;
			<a	href="javascript:buttonClean()" class="easyui-linkbutton">重置</a>
		</div>
	</fieldset>
	<div id="winBatch" class="easyui-window" 
		style="width: 600px; height: 400px" top="0"
		data-options="iconCls:'icon-save',modal:true,closed:true">
				<form id="batchForm" method="post">
					<table id="tblBatch" title="团办号代码列表" class="easyui-datagrid" style="width: 98%"
			       data-options="rownumbers:true,singleSelect:false,pagination:true,fitColumns:true,url:'',queryParams:{ydjFlag:'2'},loadMsg:'数据加载中.....',method:'post'">
					<thead>
							<tr>
							    <th field="Id" width="10%" align="center" checkbox="true">ID</th>
							     <th field="appCity" width="20%" align="center" data-options="formatter:formatAppCity" >城市</th>
								<th field="c4ApBatch" width="20%" align="center">团办号代码</th>
								<th field="num" width="20%" align="center">申请件数量</th>
							</tr>
					</thead>
					</table>
				</form>
				<div style="text-align:center;padding:5px">
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onConcle('winBatch')">取消</a>
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onSaveBatch()">保存</a>
		        </div>
	</div>
	<!-- added by jpc  -->
	<div id="winType" class="easyui-window" style="width: 600px; height: 400px" top="0"
		data-options="iconCls:'icon-save',modal:true,closed:true">
		<form id="typeForm" method="post">
			<table id="tblType" title="项目号代码列表" class="easyui-datagrid" style="width: 98%"
	       data-options="rownumbers:true,singleSelect:false,pagination:true,pageSize:20,pageList:[20, 50,100,200],fitColumns:true,url:'',queryParams:{ydjFlag:'2'},loadMsg:'数据加载中.....',method:'post'">
			<thead>
				<tr>
				    <th field="Id" width="10%" align="center" checkbox="true">ID</th>
				    <th field="appCity" width="20%" align="center" data-options="formatter:formatAppCity" >城市</th>
					<th field="c5JcType" width="20%" align="center">项目号代码</th>
					<th field="num" width="20%" align="center">申请件数量</th>
				</tr>
			</thead>
			</table>
		</form>
		<div style="text-align:center;padding:5px">
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onConcle('winType')">取消</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onSaveType()">保存</a>
        </div>
	</div>
	<div id="winAbCode" class="easyui-window" title="推广机构号查询"
		style="width: 600px; height: 400px" top="0"
		data-options="iconCls:'icon-save',modal:true,closed:true">
				<form id="abCodeForm" method="post">
					<table id="tblAbCode" title="推广机构号代码列表" class="easyui-datagrid" style="width: 98%"
			       data-options="rownumbers:true,singleSelect:false,pagination:true,fitColumns:true,url:'',queryParams:{ydjFlag:'2'},loadMsg:'数据加载中.....',method:'post'">
					<thead>
							<tr>
							    <th field="Id" width="10%" align="center" checkbox="true">ID</th>
							      <th field="appCity2" width="20%" align="center" data-options="formatter:formatAppCity" >城市</th>
								<th field="c5AbCode" width="20%" align="center">推广机构号代码</th>
								<th field="num2" width="20%" align="center">申请件数量</th>
							</tr>
						</thead>
					</table>
				</form>
				<div style="text-align:center;padding:5px">
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onConcle('winAbCode')">取消</a>
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onSaveAbCode()">保存</a>
		        </div>
	</div>
	<div id="winAbUser" class="easyui-window" title="推广人员号查询"
		style="width: 600px; height: 400px" top="0"
		data-options="iconCls:'icon-save',modal:true,closed:true">
				<form id="abUserForm" method="post">
					<table id="tblAbUser" title="推广人员号代码列表" class="easyui-datagrid" style="width: 98%"
			       data-options="rownumbers:true,singleSelect:true,pagination:true,fitColumns:true,url:'',queryParams:{ydjFlag:'2'},loadMsg:'数据加载中.....',method:'post'">
					<thead>
							<tr>
							    <th field="Id" width="10%" align="center" checkbox="true">ID</th>
							     <th field="appCity3" width="20%" align="center" data-options="formatter:formatAppCity" >城市</th>
								<th field="c4AbUser" width="20%" align="center">推广人员代码</th>
								<th field="num3" width="20%" align="center">申请件数量</th>
							</tr>
						</thead>
					</table>
				</form>
				<div style="text-align:center;padding:5px">
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onConcle('winAbUser')">取消</a>
		            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onSaveAbUser()">保存</a>
		        </div>
	</div>
	<fieldset style="margin-top: 10px;">
		<legend>分配方式</legend>
		<div class="area-tips">
			已分配：<em id="info_alloted">0</em>件 / 剩余：<strong id="info_remainder">0</strong>件
		</div>
		<input type="hidden" id="hiddenId" name="hiddenId">
		<input type="hidden" id="allotFlag" name="allotFlag">
		<div id="area_1_level" class="divHeight" >
			分配类型：<select class="easyui-combobox" name="allot_type"
				id="allot_type" dict_type="ALLOT_TYPE" editable="false"
				data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
				style="width: 150px;">
			</select>
		</div>
		<!-- 分配-按件数 -->
		<div id="area_2_level_1" class="area-operate area-2-level">
			<table>
				<tr>
					<td><input type="checkbox" value="1" />北京高风险操作1队列</td>
					<td><input type="text" class="easyui-textbox">&nbsp;件</td>
				</tr>
				<tr>
					<td><input type="checkbox" value="1" />北京高风险2队列</td>
					<td><input type="text" class="easyui-textbox">&nbsp;件</td>
				</tr>
				<tr>
					<td><input type="checkbox" value="1"  />北京高风险2队列</td>
					<td><input type="text" class="easyui-textbox">&nbsp;件</td>
				</tr>
			</table> 
		</div>
		<!-- 分配-按比例 -->
		<div id="area_2_level_2" class="area-operate area-2-level">
			<table>
				<tr>
					<td><input type="checkbox" value="1" />北京高风险1队列</td>
					<td><input type="text" class="easyui-textbox" id="1">&nbsp;%</td>
				</tr>
				<tr>
					<td><input type="checkbox" value="1" />北京高风险2队列</td>
					<td><input type="text" class="easyui-textbox" id="1">&nbsp;%</td>
				</tr>
				<tr>
					<td><input type="checkbox" value="1" />北京高风险3队列</td>
					<td><input type="text" class="easyui-textbox" id="1">&nbsp;%</td>
				</tr>
			</table> 
		</div>
		<!-- 分配-按特定件 -->
		<div id="area_2_level_3" class="area-operate area-2-level">
			 <table>
				<tr>
					<td>流水号：<input type="text" class="easyui-textbox"></td>
				</tr>
				<tr>
					<td>分配至：<select id="combox_2_level" class="easyui-combobox">
							<option>北京高风险2队列</option>
							<option>北京高风险2队列</option>
					</select></td>
				</tr>
			</table> 
		</div>
		<div class="area-function">
			<a href="javascript:fnAllot();" class="easyui-linkbutton"
				style="margin-left: 20px;">分配</a>&nbsp;
			 <a href="javascript:fnReset()" class="easyui-linkbutton">重置</a>
		</div>
	</fieldset>
	<fieldset style="margin-top: 10px;">
		<legend>转移方式</legend>
		<div id="area_transfer_level" class="divHeight" >
			转移类型：<select class="easyui-combobox" name="allot_transfer"
				id="allot_transfer"  editable="false"
				data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
				style="width: 150px;">
				<option value="-1">--请选择--</option>
				<option value="1">按件数</option>
				<option value="2">按特定件</option>
			</select>
			<input type="hidden" id="transferId" name="transferId">
		</div>
		<!-- 转移-按件数 -->
		<div id="area_transfer_level_1" class="area-transferDo  area-transfer-level">
			<table >
				<tr>
					<td>转移队列：<select id="id_tree_type" name="tree_type" class="easyui-combobox" 
					style="width:200px;">
					</select></td>
					<td>
					 <a href="javascript:void(0)" class="easyui-linkbutton" onclick="onCheckNow()">当日新接收的申请件</a>
					：<strong id="info_todayApp">0</strong>件
					<input type="checkbox" name="todayTransferApp" value="0" />转移当日新接收的申请件
					<input type="checkbox" name="transferUser" id="transferUser"  onclick="acceptUser()"/>接受队列</td>
				</tr>
			</table> 
		</div>
		<!-- 转移-按特定件 -->
		<div id="area_transfer_level_2" class="area-transferDo area-transfer-level">
			 <table>
				<tr>
					<td>流水号：<input type="text" class="easyui-textbox"></td>
				</tr>
				<tr>
					<td>接受队列：<select id="combox_transfer_level" class="easyui-combobox">
							<option>北京高风险队列</option>
							<option>北京中风险队列</option>
					</select></td>
				</tr>
			</table> 
		</div>
		<div class="area-function">
			<a href="javascript:fnTransfer();" class="easyui-linkbutton"
				style="margin-left: 20px;">转移</a>
		</div>
	</fieldset>
	<fieldset style="margin-top: 10px;">
		<legend>回收方式</legend>
		<div id="area_recovery_level" class="divHeight" >
			回收类型：<select class="easyui-combobox" 
				name="allot_recovery"
				id="allot_recovery" editable="false"
				data-options="valueField:'dictDetailCode',textField:'dictDetailName'"
				style="width: 150px;">
				<option value="0">--请选择--</option>
				<option value="1">按件数</option>
				<option value="2">按特定件</option>
			</select>
			<input type="hidden" id="recoveryId" name="recoveryId">
		</div>
		<!-- 回收-按件数 -->
		<div id="area_recovery_level_1" class="area-recoveryDo  area-recovery-level">
		</div>
		<!-- 回收-按特定件 -->
		<div id="area_recovery_level_2" class="area-recoveryDo area-recovery-level">
		</div>
		<div class="area-function2">
			<a href="javascript:fnRecovery();" class="easyui-linkbutton"
				style="margin-left: 20px;">回收</a>
		</div>
	</fieldset>
	<input type="hidden" id="jiSuan" name="jiSuan">
	</div>
	<script type="text/javascript">
		$cf.loadAllDict();
		var tblBatch = $("#tblBatch");
		var batchWindow = $("#winBatch");
		var tblType = $("#tblType");// added by jpc
		var typeWindow = $("#winType");// added by jpc
		var typeForm = $("#typeForm");// added by jpc
		var batchForm = $("#batchForm");
		var tblAbCode = $("#tblAbCode");
		var abCodeWindow = $("#winAbCode");
		var abCodeForm = $("#abCodeForm");
		var tblAbUser = $("#tblAbUser");
		var abUserWindow = $("#winAbUser");
		var abUserForm = $("#abUserForm");
		var url = location.href;
		var node = url.split("=")[1];
		var secondNode=location.href.split("=")[2];
		var ydjFlag=location.href.split("=")[3];
		var proNode=location.href.split("=")[3];
		var userCode=$cf.getStore("userRelInfo","index").userInfo.userCode;
		var userName=$cf.getStore("userRelInfo","index").userInfo.userName;
		function init(){
			// 初始化
			fnInitIdentify();
			fnInitShow();
			fnInitTime();
			fnInitTransfer();
			fnInitRecovery();
			fnLoadAppProd();
		}
		$(function() {
			//查询池中待分配件数量
			fnGetCount();
			// 初始化
			initDivHeight("area-function2");//距离底端距离
			initCommon();
			initButton();
			// 重置筛选区域
			$('#btn_query_reset').click(function() {
				fnQueryAreaReset();
			});

			// 重置操作区域
			$('#btn_operate_reset').click(function() {
				fnOperateAreaReset();
			});

			// 根据筛选条件查询申请件并反显查询结果
			$('#btn_query_all').click(function() {
				$('#info_query').text('12500');
			});
			// [事件] select 联动
			$('#identify').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						$("#child_2+.combo").hide();
						$("#child_3+.combo").hide();
						$("#child_1+.combo").show();
						break;
					case '2':
						$("#child_1+.combo").hide();
						$("#child_3+.combo").hide();
						$("#child_2+.combo").show();
						break;
					case '3':
						$("#child_1+.combo").hide();
						$("#child_2+.combo").hide();
						$("#child_3+.combo").show();
						break;
					default:
						fnInitIdentify();
					}
					
				}
			});
			$('#shareTime').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						$("#crtTimeStart+.combo").hide();
						$("#crtTimeEnd+.combo").hide();
						$("#appTimeStart+.combo").show();
						$("#appTimeEnd+.combo").show();
						break;
					case '2':
						$("#appTimeStart+.combo").hide();
						$("#appTimeEnd+.combo").hide();
						$("#crtTimeStart+.combo").show();
						$("#crtTimeEnd+.combo").show();
						break;
					default:
						fnInitTime();
					}
					
				}
			});
			// [事件] 分配类型
			$('#area_1_level select').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						fnShowById(n);
						break;
					case '2':
						fnShowById(n);
						break;
					case '3':
						fnShowById(n);
						break;
					default:
						fnInitShow();
					}
					fnOperateAreaReset();
				}
			});
			//转移类型
			$('#area_transfer_level select').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						fnShowTransferById(n);
						break;
					case '2':
						fnShowTransferById(n);
						break;
					default:
						fnInitTransfer();
					}
					fnTransferAreaReset();
				}
			});
			//回收类型
			$('#area_recovery_level select').combobox({
				onChange : function(n, o) {
					switch (n) {
					case '1':
						fnShowRecoveryById(n);
						break;
					case '2':
						fnShowRecoveryById(n);
						break;
					default:
						fnInitRecovery();
					}
					fnRecoveryAreaReset();
				}
			});	
		
		//初始化 根据节点 
		if(node==1){//审查 
			$("#creditDecisionLayer").combobox({disabled:true});
			$("#creditDecisionResult").combobox({disabled:true});
			$("#decisionResult").combobox({disabled:true});
			$("#custFlag").combobox({disabled:true});
			$("#minProposedLmt").textbox('disable');
			$("#maxProposedLmt").textbox('disable');
			$("#triggerType1").textbox('disable');
			$("#triggerType2").textbox('disable');
		}
		});
		
		//分配重置 
		function fnQueryAreaReset() {
			$('#l_2').combobox('clear');
			$('#l_2').combobox('select', '0');
		}

		function fnOperateAreaReset_1() {
			$('#area_2_level_1 input').val('');
		}

		function fnOperateAreaReset_2() {
			$('#area_2_level_2 input').val('');
		}

		function fnOperateAreaReset_3() {
			$('#area_2_level_3 input').val('');
		}

		function fnOperateAreaReset() {
			fnOperateAreaReset_1();
			fnOperateAreaReset_2();
			fnOperateAreaReset_3();
		} 
		//转移重置 
		function fnTransferAreaReset() {
			$('#area_transfer_level_1 input').val('');
			$('#area_transfer_level_2 input').val('');
		}
		// 回收重置 
		function fnRecoveryAreaReset() {
			$('#area_recovery_level_1 input').val('');
			$('#area_recovery_level_2 input').val('');
		}
		function fnInitShow() {
			$('.area-operate').addClass('display');
			$('#area_1_level').removeClass('display');
		}
		function fnInitTransfer() {
			$('.area-transferDo').addClass('display');
			$('#area_transfer_level').removeClass('display');
		}
		function fnInitRecovery() {
			$('.area-recoveryDo').addClass('display');
			$('#area_recovery_level').removeClass('display');
		}
		function fnInitIdentify() {
			$("#child_1 +.combo").hide();
			$("#child_2 +.combo").hide();
			$("#child_3 +.combo").hide();
		}
		function fnInitTime(){
			$("#appTimeStart+.combo").hide();
			$("#appTimeEnd+.combo").hide();
			$("#crtTimeStart+.combo").hide();
			$("#crtTimeEnd+.combo").hide();
		}
		
		function fnGetCount(){
			$cf.ajax({
				url : "/opas-allot-server/countAppId.json",
				data:{'node':node,
					'secondNode':secondNode,
					'ydjFlag':'2',
					'userCode':userCode
					},
				onSuccess : function(respObj) {
					var count = respObj.RSP_BODY.total;
					var count2 = respObj.RSP_BODY.total2;
					$(".countAppId").text(count);
					$(".quickAppId").text(count2);
					$("#jiSuan").val(count);
				}
			});
		}
		//条件查询  
		function fnQuery() {
			var seachForm = $("#seachForm");
			var shareTimeValue=$("#shareTime").combobox("getValues");
			var appTimeStart = $('#appTimeStart').datebox('getValue');
			var appTimeEnd = $('#appTimeEnd').datebox('getValue');
			var crtTimeStart = $('#crtTimeStart').datebox('getValue');
			var crtTimeEnd = $('#crtTimeEnd').datebox('getValue');
			if(shareTimeValue == "1"){
				if(appTimeStart == "" || appTimeEnd == ""){//没有选择起止时间
					showWaringBox('请选择起止时间.');
					return null;
				}
				var appTimeDay = GetDateDiff(appTimeStart,appTimeEnd);
				if (appTimeDay > 6){
					alert("条形码日期区间不能超过7天");
					return;
				}
			}else if(shareTimeValue == "2"){
				if(crtTimeStart == "" || crtTimeEnd == ""){//没有选择起止时间
					showWaringBox('请选择起止时间.');
					return null;
				}
				var crtTimeDay = GetDateDiff(crtTimeStart,crtTimeEnd);
				if (crtTimeDay > 6){
					alert("进件日期区间不能超过7天");
					return;
				}
			}
			var jsondata = getFormMulData(seachForm.serializeArray());
			$cf.ajax({
				url : "/opas-allot-server/queryAppByConditions.json",
				data : {'jsondata':jsondata,
					'node':node,
					'secondNode':secondNode,
					'ydjFlag':'2',
					'userCode':userCode},
				onSuccess : function(respObj) {
					var count = respObj.RSP_BODY.total;
					$('#info_query').text(count);
					fnGetCount();
				}
			});
			window.scroll(0,0);
		}
		function fnShowById(id) {
			$("input[name='hiddenId']").val(id);
			fnInitShow();
			var result = '';
		    //将已分配件数重置
			$('#info_alloted').text(0);
			if (node == '02') {
					$cf.ajax({
						url : "/opas-allot-server/showAllotQueue.json",
						data:{"node":node,
							"ydjFlag":'2',
							"userCode":userCode	
						},
						onSuccess : function(respObj) {
							var queueList = respObj.RSP_BODY.queueList;
							if (id == '1') {
								result+="<table  id='allotTable'>";
								result+="<tr><td><input type='checkbox'  id='all'  name='all' style='all' onclick='selectAll(1)'  value='false'  /> 全选</td></tr>";
								for (var i = 0; i < queueList.length; i++) {
									result += "<tr>";
									result += " <td><input type='checkbox'  onclick='selectOne(1)'  value='"+queueList[i].queueCode+"' name='queueorgroup'/> "
											+ queueList[i].queueName +'-待分配件为'+ queueList[i].queueNum+ "</td>";
									result += "<td><input type='text'  oninput='fnJiSuan(2)' name='jiSuanId' id='"+queueList[i].queueCode+"'/>件</td>";
									result += "</tr>";
								}
								result+="</table>";
							} else if (id == '2') {
								result+="<table id='allotTable2' >";
								result+="<tr><td><input type='checkbox' id='all2'  name='all2' onclick='selectAll(2)'  value='false'  /> 全选</td></tr>";
								for (var i = 0; i < queueList.length; i++) {
									result += "<tr>";
									result += " <td><input type='checkbox' onclick='selectOne(2)'  value='"+queueList[i].queueCode+'2'+"' name='queueorgroup2'/> "
											+ queueList[i].queueName +'-待分配件为'+ queueList[i].queueNum+ "</td>";
									result += "<td><input type='text' class='easyui-textbox' id='"+queueList[i].queueCode+'2'+"'/>%</td>";
									result += "</tr>";
								}
								result+="</table>";
							} else if (id == '3') {
								result+="<table id='allotTable3' >";
								result += "<tr>";
								result += " <td>流水号<input type='text' id='appId' > </td>";
								result += "</tr>";
								result += "<tr>";
								result += " <td>分配至<select id='combox_2_level' class='easyui-combobox' style='width:400px;'><option value='-1'>请选择</option>";
								for (var i = 0; i < queueList.length; i++) {
									result += "<option value='"+queueList[i].queueCode+"'>"
											+ queueList[i].queueName+'-待分配件为'+ queueList[i].queueNum
											+ "</option>";
								}
								result += "</select></td>";
								result += "</tr>";
								result+="</table>";
							}
							$('#area_2_level_' + id).html(result);
							$('#area_2_level_' + id).removeClass('display');
						}
					});
			} else if (node == '01' || node == '03') {
				$cf.ajax({
							url : "/opas-allot-server/showAllotGroup.json",
							data:{"node":node,
								"orgLevel":'4',
								'secondNode':'1',
								"userCode":userCode	
							},
							onSuccess : function(respObj) {
								var groupList = respObj.RSP_BODY.groupList;
								if (id == '1') {
									result+="<table id='allotTable4' >";
									result+="<tr><td><input type='checkbox' id='all' name='all' onclick='selectAll(1)' /> 全选</td></tr>";
									for (var i = 0; i < groupList.length; i++) {
										result += "<tr>";
										result += " <td><input type='checkbox' onclick='selectOne(1)'  value='"+groupList[i].orgNo+"' name='queueorgroup'/> "
												+ groupList[i].orgName+'-待分配件为'+ groupList[i].orgNum + "</td>";
										result += "<td><input type='text' oninput='fnJiSuan(2)'  name='jiSuanId' id='"+groupList[i].orgNo+"'/>件</td>";
										result += "</tr>";
									}
									result+="</table>";
								} else if (id == '2') {
									result+="<table id='allotTable5' >";
									result+="<tr><td><input type='checkbox' id='all2'  name='all2'  onclick='selectAll(2)' /> 全选</td></tr>";
									for (var i = 0; i < groupList.length; i++) {
										result += "<tr>";
										result += " <td><input type='checkbox' onclick='selectOne(2)'  value='"+groupList[i].orgNo+'2'+"' name='queueorgroup2'/> "
												+ groupList[i].orgName+'-待分配件为'+ groupList[i].orgNum + "</td>";
										result += "<td><input type='text' class='easyui-textbox' id='"+groupList[i].orgNo+'2'+"'/>%</td>";
										result += "</tr>";
									}
									result+="</table>";
								} else if (id == '3') {
									result+="<table id='allotTable6' >";
									result += "<tr>";
									result += " <td>流水号<input type='text' id='appId'  class='easyui-textbox'> </td>";
									result += "</tr>";
									result += "<tr>";
									result += " <td>分配至<select id='combox_2_level' class='easyui-combobox' style='width:400px;'><option value='-1'>请选择</option>";
									for (var i = 0; i < groupList.length; i++) {
										result += "<option value='"+groupList[i].orgNo+"'>"
												+ groupList[i].orgName+'-待分配件为'+ groupList[i].orgNum
												+ "</option>";
									}
									result += "</select></td>";
									result += "</tr>";
									result+="</table>";
								}
								$('#area_2_level_' + id).html(result);
								$('#area_2_level_' + id).removeClass('display');
							}
						});
			}
		}
		//按申请件个数、比例、申请件编号分配
		function fnAllot() {
			//首先判断查询条件是否为已分配或挂起状态 
			var appStatus=$("#appStatus").combobox('getValue');
			if(appStatus=='2'){
				$.messager.alert("提示","目前查询条件已分配被选中,请去掉  ");
				return;
			}
			var appStatus2=document.getElementsByName('appStatus2');
			if(appStatus2[0].checked){
				$.messager.alert("提示","目前查询条件挂起标签被选中,请去掉  ");
				return;
			};
			//首先判断是否分件进行中  如果进行中  提示稍等片刻
			var  allotFlag=$("#allotFlag").val();
			if(allotFlag=='1'){
				$.messager.alert("提示","目前正分件处理中,不要频繁点击,亲请先休息小会儿... ");
				return;
			}else{//未处于分件中   赋值 正在分件
				$("#allotFlag").val("1");
			}
			var num= $('#info_query').text();
			var id = $("input[name='hiddenId']").val();
			if(id==null||id==""||id=="-1"){
				$("#allotFlag").val("0");
				$.messager.alert("操作提示","分配类型必须选择 ","error");
				return;
			}
			var seachForm = $("#seachForm");
			var jsondata = getFormMulData(seachForm.serializeArray());
			var queueInfo = "";
			var allotValue = "";
			var appId = "";
			var queueCode = "";
			var a=0;
			if (id == '1'||id== '2') {
				var obj='';
				if(id=='1'){
					obj=document.getElementsByName("queueorgroup");
					for(var k=0;k<obj.length;k++){
						if(obj[k].checked){
							var queue = $(obj[k]).val();
							var queueValue = $("#" + queue).val();
							if (queueValue == null || queueValue == "") {
								$("#allotFlag").val("0");
								 $.messager.alert("操作提示","勾选后必须输入值","error");
								return;
							} else {
								queueInfo += queue + ":" + queueValue + ";";
							}
							a++;
						}
					}
				}else if(id=='2'){
					obj=document.getElementsByName("queueorgroup2");
					//统计百分数
					var totalWeight=0;
					for(var k=0;k<obj.length;k++){
						if(obj[k].checked){
							var queue = $(obj[k]).val();
							var queueValue = $("#" + queue).val();
							totalWeight=totalWeight+parseInt(queueValue);
							if (queueValue == null || queueValue == "") {
								$("#allotFlag").val("0");
								 $.messager.alert("操作提示","勾选后必须输入值","error");
								return;
							} else {
								var a=queue.substring(0,queue.length-1);
								queueInfo += a + ":" +queueValue+ ";";
							}
							a++;
						}
					}
					if(totalWeight>100){
						$("#allotFlag").val("0");
						$.messager.alert("操作提示","采用百分比分配时输入值总和大于100","error");
						return;
					}
				}
				if(a==0){
					$("#allotFlag").val("0");
					if(node=="02"){
						 $.messager.alert("操作提示","要分配到的队列必须选择 ","error");
					}else if(node=="01"||node=="03"){
						 $.messager.alert("操作提示","要分配到的组 必须选择 ","error");
					}
					return;
				}
				$cf.ajax({
					url : "/opas-allot-server/handQueueOrGroup.json",
					data : {
						'jsondata' : jsondata,
						'queueInfo' : queueInfo,
						'id' : id,
						'userCode':userCode,
						'ydjFlag':'2',
						'secondNode':secondNode,
						'node':node
					},
					onSuccess : function(respObj) {
						if (respObj.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "分配成功 ! ", "info", function() {
								//已分配
								var count = respObj.RSP_BODY.allotTotal;
								$('#info_alloted').text(count);
								fnGetCount();
								//剩余件
								//var countAppId = $(".countAppId").text();
								var countAppId =$("#jiSuan").val();
								var rest=countAppId-count;
								$('#info_remainder').text(rest);
								//查询结果剩余
								fnQuery();
								//初始化
								fnInitShow();
								$('#allot_type').combobox('clear');
								$('#allot_type').combobox("setValue",'--请选择--'); 
								//分件成功与否  都将分件标识重置  为下次分件做准备
								$("#allotFlag").val("0");
							});
						} else {
							$.messager.alert("操作提示", "分配异常,原因:  " + respObj.RSP_BODY.exMsg, "error");
							fnGetCount();
							//查询结果剩余
							fnQuery();
							fnInitShow();
							$('#allot_type').combobox('clear');
							$('#allot_type').combobox("setValue",'--请选择--'); 
							//分件成功与否  都将分件标识重置  为下次分件做准备
							$("#allotFlag").val("0");
							return;
						}
						
					}
				});
				
			}else if (id == '3') {
				var appId = $("#appId").val();
				if (appId == '' || appId == null ) {
					$("#allotFlag").val("0");
					$.messager.alert("操作提示","流水号为空 ","error");
					return;
				} 
				var code = $("#combox_2_level  option:selected").val();
				if ( code == '' || code == null || code == '-1') {
					$("#allotFlag").val("0");
					if(node=='01'||node=='03'){
						$.messager.alert("操作提示","组未选择 ","error");
					}else if(node=='02'){
						$.messager.alert("操作提示","队列未选择","error");
					}
					return;
				} 
				$cf.ajax({
					url : "/opas-allot-server/handQueueOrGroup.json",
					data : {
						'jsondata' : jsondata,
						'id' : id,
						'appId' : appId,
						'code' : code,
						'userCode':userCode,
						'ydjFlag':'2',
						'secondNode':secondNode,
						'node':node
					},
					onSuccess : function(respObj) {
						if (respObj.RSP_BODY.isSuccess){
							$.messager.alert("操作提示", "分配成功 ! ", "info", function() {
								//已分配
								var count = respObj.RSP_BODY.allotTotal;
								$('#info_alloted').text(count);
								fnGetCount();
								//剩余件
								//var countAppId = $(".countAppId").text();
								var countAppId =$("#jiSuan").val();
								var rest=countAppId-count;
								$('#info_remainder').text(rest);
								//查询结果剩余
								fnQuery();
								fnInitShow();
								$('#allot_type').combobox('clear');
								$('#allot_type').combobox("setValue",'--请选择--'); 
								//分件成功与否  都将分件标识重置  为下次分件做准备
								$("#allotFlag").val("0");
							});
						} else {
							$.messager.alert("操作提示", "分配异常,原因:  " + respObj.RSP_BODY.exMsg, "error");
							fnGetCount();
							//查询结果剩余
							fnQuery();
							fnInitShow();
							$('#allot_type').combobox('clear');
							$('#allot_type').combobox("setValue",'--请选择--'); 
							//分件成功与否  都将分件标识重置  为下次分件做准备
							$("#allotFlag").val("0");
							return;
						}
						
					}
				});
			}
		}
		
		//转移 情况  
		function fnShowTransferById(id) {
			$("input[name='transferId']").val(id);
			fnInitTransfer();
			var result = '';
			if(node==02){
				$cf.ajax({
					url : "/opas-allot-server/showAllotQueue.json",
					data:{'node':node,
						'userCode':userCode,
						'isHangUp':'1'
						},
					onSuccess : function(respObj) {
						var queueList = respObj.RSP_BODY.queueList;
						if (id == '1') {
							result+="<table>";
							result += "<tr>";
							result += " <td>转移队列   <select id='id_tree_type' name='tree_type' class='easyui-combobox' style='width:400px;'><option value='-1'>请选择</option>";
							for (var i = 0; i < queueList.length; i++) {
								result += "<option value='"+queueList[i].queueCode+"4"+"'>"
										+ queueList[i].queueName+'-待分配未挂起件为'+ queueList[i].queueNum
										+ "</option>";
							}
							result += "</select></td>";	
							result += "<td><input type='button' value='查询' style='width:100px;' onClick='fnChaXun(1)'/>&nbsp;&nbsp;可分配：<strong id='chaXunId1'></strong>件</td>";
							result += "</tr>";
							result += "<tr><td>";
							result += "<a href='javascript:void(0)' class='easyui-linkbutton' onclick='onCheckNow(1)'>当日新接收的申请件</a>";
							result += "：<strong id='info_todayApp'>0</strong>件";
							result += "<input type='checkbox' name='todayTransferApp' id='todayTransferApp' /> 转移当日新接收的申请件标识  ";
							result += "</td>";
							result += "</tr>";
							result += "<tr><td>接收队列: </td></tr>";
							result+="<tr><td><input type='checkbox' id='all3' name='all3' onclick='selectAll(3)' /> 全选</td></tr>";
							for (var i = 0; i < queueList.length; i++) {
									result += "<tr>";
									result += " <td><input type='checkbox' onclick='selectOne(3)' value='"+queueList[i].queueCode+"5"+"' name='acceptQueue'/> "
											+ queueList[i].queueName +'待分配未挂起件为'+ queueList[i].queueNum+ "</td>";
									result += "<td><input type='text' class='easyui-textbox' id='"+queueList[i].queueCode+"5"+"'/>件</td>";
									result += "</tr>";
							}
							result+="</table>";
						}  else if (id == '2') {
							result+="<table>";
							result += "<tr>";
							result += " <td>流水号<input type='text' id='appId2'  class='easyui-textbox'> </td>";
							result += "</tr>";
							result += "<tr>";
							result += " <td>转移至 <select id='combox_transfer_level' class='easyui-combobox' style='width:400px;'><option value='-1'>请选择</option>";
							for (var i = 0; i < queueList.length; i++) {
								result += "<option value='"+queueList[i].queueCode+"6"+"'>"
										+ queueList[i].queueName+'待分配未挂起件为'+ queueList[i].queueNum
										+ "</option>";
							}
							result += "</select></td>";
							result += "</tr>";
							result+="</table>";
						}
						$('#area_transfer_level_' + id).html(result);
						$('#area_transfer_level_' + id).removeClass('display');
					}
				});
			}else if(node==01||node==03){
				$cf.ajax({
					url : "/opas-allot-server/showAllotGroup.json",
					data:{'node':node,
						"orgLevel": '4' ,
						'secondNode':'1',
						'userCode':userCode,
						'isHangUp':'1'
						},
					onSuccess : function(respObj) {
						var groupList = respObj.RSP_BODY.groupList;
						if (id == '1') {
							result+="<table>";
						 	result += "<tr>";
							result += " <td>转移组  <select id='id_tree_type2' name='tree_type' class='easyui-combobox' style='width: 320px;'><option value='-1'>请选择</option>";
							for (var i = 0; i < groupList.length; i++) {
								result += "<option value='"+groupList[i].orgNo+"4"+"'>"
										+ groupList[i].orgName+'-待分配未挂起件为'+ groupList[i].orgNum
										+ "</option>";
							}
							result += "</select></td>";	
							result += "<td><input type='button' value='查询' style='width:100px;' onClick='fnChaXun(2)'/>&nbsp;&nbsp;可分配：<strong id='chaXunId2'></strong>件</td>";
							result += "</tr>"; 
							result += "<tr><td>";
							result += "<a href='javascript:void(0)' class='easyui-linkbutton' onclick='onCheckNow(2)'>当日新接收的申请件</a>";
							result += "：<strong id='info_todayApp2'>0</strong>件";
							result += "<input type='checkbox' name='todayTransferApp2'   id='todayTransferApp2'/> 转移当日新接收的申请件标识  ";
							result += "</td>";
							result += "</tr>";
							result += "<tr><td>接收组:</td></tr>";
							result+="<tr><td><input type='checkbox' id='all4' name='all4' onclick='selectAll(4)' /> 全选</td></tr>";
							for (var i = 0; i < groupList.length; i++) {
									result += "<tr>";
									result += " <td><input type='checkbox' onclick='selectOne(4)' value='"+groupList[i].orgNo+"5"+"' name='acceptGroup'/> "
											+ groupList[i].orgName+'-待分配未挂起件为'+ groupList[i].orgNum + "</td>";
									result += "<td><input type='text' class='easyui-textbox' id='"+groupList[i].orgNo+"5"+"'/>件</td>";
									result += "</tr>";
							}
							result+="</table>";
						}  else if (id == '2') {
							result+="<table>";
							result += "<tr>";
							result += " <td>流水号<input type='text' id='appId3'  > </td>";
							result += "</tr>";
							result += "<tr>";
							result += " <td>转移至 <select id='combox_transfer_level2' class='easyui-combobox' style='width: 320px;'><option value='-1'>请选择</option>";
							for (var i = 0; i < groupList.length; i++) {
								result += "<option value='"+groupList[i].orgNo+"6"+"'>"
										+ groupList[i].orgName+'-待分配未挂起件为'+ groupList[i].orgNum
										+ "</option>";
							}
							result += "</select></td>";
							result += "</tr>";
							result+="</table>";
						}
						$('#area_transfer_level_' + id).html(result);
						$('#area_transfer_level_' + id).removeClass('display');
					}
				});
			}
			
		}
		function fnTransfer() {
			var id = $("input[name='transferId']").val();
			if(id==null||id==""||id=="-1"){
				$.messager.alert("操作提示","转移类型必须选择  ","error");
				return;
			}
			if (id == '1') {
				var seachForm = $("#seachForm");
				var jsondata = getFormMulData(seachForm.serializeArray());
				var currCode="";
				var queueInfo='';
				var transferType='';
				var obj="";
				var a=0;
				var allNum=0;
				//要转走的申请件总和 
				var tranSum=0;
				 if(node==02){
					var curr = $("#id_tree_type  option:selected").val(); 
					//要转移的队列申请件  
					allNum=$("#id_tree_type  option:selected").text().split("为")[1];
					if (curr == '' ||curr == null ||curr=='-1') {
						$.messager.alert("操作提示","转移队列为空","error");
						return;
					}
					var currCode =curr.substring(0,curr.length-1);
					if(document.getElementById("todayTransferApp").checked){
						 transferType='1';//选中
					}else{
						transferType='0';//未选中
					}
					obj=document.getElementsByName("acceptQueue");
					for(var k=0;k<obj.length;k++){
						if(obj[k].checked){
							var queue = $(obj[k]).val();
							var b=queue.substring(0,queue.length-1);
							if(b==currCode){
								 $.messager.alert("操作提示","转移队列同时被选为接收队列,应去掉 !","error");
								 return;
							}
							var queueValue = $("#" + queue).val();
							if (queueValue == null || queueValue == "") {
								 $.messager.alert("操作提示","勾选后必须输入值","error");
								return;
							} else {
								 tranSum+=parseInt(queueValue);
								 queueInfo += b + ":" + queueValue + ";";
							}
							a++;
						}
					}
					
				}else  if(node==01||node==03){
					var curr = $("#id_tree_type2  option:selected").val(); 
					//要转移的组申请件   
					allNum=$("#id_tree_type2  option:selected").text().split("为")[1];
					if (curr == '' ||curr == null ||curr=='-1') {
						$.messager.alert("操作提示","转移组为空","error");
						return;
					}
					var currCode=curr.substring(0,curr.length-1);
					if(document.getElementById("todayTransferApp2").checked){
						 transferType='1';//选中
					}else{
						transferType='0';//未选中
					}
					obj=document.getElementsByName("acceptGroup");
					for(var k=0;k<obj.length;k++){
						if(obj[k].checked){
							var queue = $(obj[k]).val();
							var ab=queue.substring(0,queue.length-1);
							if(ab==currCode){
								 $.messager.alert("操作提示","转移组同时被选为接收组,应去掉  !","error");
								 return;
							}
							var queueValue = $("#" + queue).val();
							if (queueValue == null || queueValue == "") {
								 $.messager.alert("操作提示","勾选后必须输入值","error");
								return;
							} else {
								tranSum+=parseInt(queueValue);
								queueInfo += ab + ":" + queueValue + ";";
							}
							a++;
						}
					}
				}
				 if(a==0){
						if(node=="02"){
							 $.messager.alert("操作提示","要转移到的队列必须选择  ","error");
						}else if(node=="01"||node=="03"){
							 $.messager.alert("操作提示","要转移 到的组必须选择 ","error");
						}
						return;
				}
				if(parseInt(allNum)<parseInt(tranSum)){
					if(node=="02"){
						$.messager.alert("操作提示","要转移的总件数不能大于当前转移队列的总申请件  ","error");
					}else if(node=="01"||node=="03"){
						$.messager.alert("操作提示","要转移的总件数不能大于当前转移组的总申请件 ","error");
					}
					return;
				}
				$cf.ajax({
					url : "/opas-allot-server/transferApply.json",
					data : {
						'id' : id,
						'currCode' : currCode,
						'transferType' : transferType,
						'queueInfo' : queueInfo,
						'secondNode':secondNode,
						'ydjFlag':'2',
						"userCode":userCode,
						'node':node,
						'jsondata':jsondata
					},
					onSuccess : function(data) {
						if (data.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "转移成功 ! ", "info", function() {
								fnInitTransfer();
								fnQuery();
								$('#allot_transfer').combobox('clear');
								$('#allot_transfer').combobox("setValue",'--请选择--'); 
							});
						} else {
							$.messager.alert("操作提示", "转移 异常,原因: " + data.RSP_BODY.exMsg, "error");
							fnInitTransfer();
							fnQuery();
							$('#allot_transfer').combobox('clear');
							$('#allot_transfer').combobox("setValue",'--请选择--'); 
							return;
						}
					}
				});
			}else if (id == '2') {
				var appId = '';
				var cur='';
				var currCode='';
				if(node==02){
					appId = $("#appId2").val();
					if (appId == '' || appId == null ) {
						$.messager.alert("操作提示","流水号为空","error");
						return;
					} 
					cur=$("#combox_transfer_level  option:selected").val();
					currCode = cur.substring(0,cur.length-1);
					if (cur == '' || cur == null || cur == "-1") {
						$.messager.alert("操作提示","队列未选择","error");
						return;
					} 
				}else if(node==01||node==03){
					appId = $("#appId3").val();
					if (appId == ''|| appId == null ) {
						$.messager.alert("操作提示","流水号为空","error");
						return;
					} 
					cur = $("#combox_transfer_level2  option:selected").val();
					currCode=cur.substring(0,cur.length-1);
					if ( cur == ''||cur == null||cur=="-1") {
						$.messager.alert("操作提示","组未选择","error");
						return;
					} 
				}
				$cf.ajax({
					url : "/opas-allot-server/transferApply.json",
					data : {
						'id' : id,
						'appId' : appId,
						'currCode' : currCode,
						'userCode':userCode,
						'secondNode':secondNode,
						'ydjFlag':'2',
						'node':node
					},
					onSuccess : function(data) {
						if (data.RSP_BODY.isSuccess) {
							$.messager.alert("操作提示", "转移成功 ! ", "info", function() {
								fnInitTransfer();
								fnQuery();
								$('#allot_transfer').combobox('clear');
								$('#allot_transfer').combobox("setValue",'--请选择--'); 
							});
						} else {
							$.messager.alert("操作提示", "转移 异常,原因: " + data.RSP_BODY.exMsg, "error");
							fnInitTransfer();
							fnQuery();
							$('#allot_transfer').combobox('clear');
							$('#allot_transfer').combobox("setValue",'--请选择--'); 
							return;
						}
					}
				});
			}
			
		}
		
		//回收(组)
		function fnShowRecoveryById(id) {
				$("input[name='recoveryId']").val(id);
				fnInitRecovery();
				var result = '';
				if(node==02){
					$cf.ajax({
						url : "/opas-allot-server/showAllotQueue.json",
						data:{'node':node,
							'ydjFlag':'2',
							'userCode':userCode
							},
						onSuccess : function(respObj) {
								var queueList = respObj.RSP_BODY.queueList;
								if (id == '1') {
									result+="<table>";
									result += "<tr>";
									result += " <td>回收队列 <select id='id_recovery_type' class='easyui-combobox' style='width:400px;'><option value='-1'>请选择</option>";
									for (var i = 0; i < queueList.length; i++) {
										result += "<option value='"+queueList[i].queueCode+"7"+"'>"
												+ queueList[i].queueName+'-待分配未挂起件为'+ queueList[i].queueNum
												+ "</option>";
									}
									result += "</select>";	
									result += "<input type='button' value='查询' style='width:100px;' onClick='fnChaXun(3)'/>&nbsp;&nbsp;可分配：<strong id='chaXunId3'></strong>件&nbsp;&nbsp;";
									result += "<a href='javascript:void(0)' class='easyui-linkbutton' onclick='onCheckNow(3)'>当日新接收的申请件</a>";
									result += "：<strong id='info_todayApp3'>0</strong>件";
									result += "<input type='checkbox' name='todayRecoveryApp' id='todayRecoveryApp' onclick='onFuZhi(3)' />回收当日新接收的申请件标识 ";
									result += "回收件数：<input  name='recoveryNum' id='recoveryNum' type='text' /> ";
									result += "回收节点  <select id='recoveryNode' class='easyui-combobox'><option value='-1'>请选择</option>";
									result += "<option value='1'>待分配池</option>";	
									result += "</select>";	
									result += "</td>";
									result += "</tr>";
									result+="</table>";
								} else if (id == '2') {
									result+="<table>";
									result += "<tr>";
									result += " <td>流水号<input type='text' id='appId4'  class='easyui-textbox'> </td>";
									result += "</tr>";
									result += "<tr>";
									result += " <td>回收节点 <select id='recoveryNode2' class='easyui-combobox'><option value='-1'>请选择</option>";
									result += "<option value='1'>待分配池</option>";	
									result += "</select></td>";
									result += "</tr>";
									result+="</table>";
								}
								$('#area_recovery_level_' + id).html(result);
								$('#area_recovery_level_' + id).removeClass('display');
							}
						});
				}else if(node==01||node==03){
					$cf.ajax({
						url : "/opas-allot-server/showAllotGroup.json",
						data:{'node':node,
							"orgLevel": '4' ,
							'secondNode':'1',
							'ydjFlag':'2',
							'userCode':userCode
							},
						onSuccess : function(respObj) {
								var groupList = respObj.RSP_BODY.groupList;
								if (id == '1') {
									result+="<table>";
									result += "<tr>";
									result += " <td>回收组 <select id='id_recovery_type' class='easyui-combobox' style='width:330px;'><option value='-1'>请选择</option>";
									for (var i = 0; i < groupList.length; i++) {
										result += "<option value='"+groupList[i].orgNo+"7"+"'>"
												+ groupList[i].orgName+'-待分配未挂起件为'+ groupList[i].orgNum
												+ "</option>";
									}
									result += "</select>";	
									result += "<input type='button' value='查询' style='width:100px;' onClick='fnChaXun(4)'/>&nbsp;&nbsp;可分配：<strong id='chaXunId4'></strong>件&nbsp;&nbsp;";
									result += "<a href='javascript:void(0)' class='easyui-linkbutton' onclick='onCheckNow(4)'>当日新接收的申请件</a>";
									result += "：<strong id='info_todayApp4'>0</strong>件";
									result += "<input type='checkbox' name='todayRecoveryApp2' id='todayRecoveryApp2' onclick='onFuZhi(4)' />回收当日新接收的申请件标识 ";
									result += "回收件数：<input  name='recoveryNum2' id='recoveryNum2' type='text' /> ";
								 	result += "回收节点  <select id='recoveryNode' class='easyui-combobox'><option value='-1'>请选择</option>";
									result += "<option value='1'>待分配池</option>";	
									result += "</select>"; 	
									result += "</td>";
									result += "</tr>";
									result+="</table>";
								} else if (id == '2') {
									result+="<table>";
									result += "<tr>";
									result += " <td>流水号<input type='text' id='appId4' > </td>";
									result += "</tr>";
									result += "<tr>";
									result += " <td>回收节点 <select id='recoveryNode2' class='easyui-combobox'><option value='-1'>请选择</option>";
									result += "<option value='1'>待分配池</option>";	
									result += "</select></td>";
									result += "</tr>";
									result+="</table>";
								}
								$('#area_recovery_level_' + id).html(result);
								$('#area_recovery_level_' + id).removeClass('display');
							}
						});
				}
			}
	
			function fnRecovery() {
				var id=$("input[name='recoveryId']").val();
				if(id==null||id==""||id=="-1"){
					$.messager.alert("操作提示","回收类型必须选择   ","error");
					return;
				}
				var cur="";
				if (id == '1') {
					var seachForm = $("#seachForm");
					var jsondata = getFormMulData(seachForm.serializeArray());
					var cur = $("#id_recovery_type  option:selected").val();
					var currCode=cur.substring(0,cur.length-1);
					if (cur == null || cur == ""||cur == "-1" ) {
						if(node=='02'){
							 $.messager.alert("操作提示","回收队列一定要选值  ","error");
						}else if(node=='01'||node=='03'){
							 $.messager.alert("操作提示","回收组一定要选值  ","error");
						}
						return;
					} 
					var recoveryType="";
					var recoveryNum="";
					if(node==02){
						recoveryNum=$("#recoveryNum").val();
						if(document.getElementById("todayRecoveryApp").checked){
							recoveryType='1';//选中
						}else{
							recoveryType='0';//未选中
						}
					}else if(node==01||node==03){
						recoveryNum=$("#recoveryNum2").val();
						if(document.getElementById("todayRecoveryApp2").checked){
							recoveryType='1';//选中
						}else{
							recoveryType='0';//未选中
						}
					}
					if(recoveryType=="0"){//未选择当日申请件回收  
						if (recoveryNum == null || recoveryNum == "") {
							 $.messager.alert("操作提示","未选择当日申请件回收  ，回收件数框一定要输值  ","error");
							return;
						} 
					}
					var recoveryNode = $("#recoveryNode  option:selected").val();
					if (recoveryNode == null || recoveryNode == ""||recoveryNode == "-1" ) {
						 $.messager.alert("操作提示","回收节点一定要选值  ","error");
						return;
					} 
					$cf.ajax({
						url : "/opas-allot-server/recoveryApply.json",
						data : {
							'id':id,
							'currCode' : currCode,
							'recoveryType' : recoveryType,
							'recoveryNum' : recoveryNum,
							'node':node,
							'secondNode':secondNode,
							'ydjFlag':'2',
							'userCode':userCode,
							'recoveryNode':recoveryNode,
							'jsondata':jsondata
						},
						onSuccess : function(data) {
							if (data.RSP_BODY.isSuccess) {
								$.messager.alert("操作提示", "回收成功 !", "info", function() {
									fnQuery();
									fnInitRecovery();
									$('#allot_recovery').combobox('clear');
									$('#allot_recovery').combobox("setValue",'--请选择--'); 
									
								});
							} else {
								$.messager.alert("操作提示", "回收异常,原因: " + data.RSP_BODY.exMsg, "error");
								fnQuery();
								fnInitRecovery();
								$('#allot_recovery').combobox('clear');
								$('#allot_recovery').combobox("setValue",'--请选择--'); 
								return;
							}
						}
					});
				}else if (id == '2') {
					var appId = $("#appId4").val();
					if (appId == ''||appId == null ) {
						$.messager.alert("操作提示","流水号为空","error");
						return;
					} 
					var recoveryNode = $("#recoveryNode2  option:selected").val();
					if (recoveryNode == '' || recoveryNode == null) {
						$.messager.alert("操作提示","回收节点 未选择 ","error");
						return;
					} 
					$cf.ajax({
						url : "/opas-allot-server/recoveryApply.json",
						data : {
							'id':id,
							'appId':appId,
							'node':node,
							'secondNode':secondNode,
							'ydjFlag':'2',
							'userCode':userCode,
							'recoveryNode':recoveryNode
						},
						onSuccess : function(data) {
							if (data.RSP_BODY.isSuccess) {
								$.messager.alert("操作提示", "回收成功 !", "info", function() {
									fnQuery();
									fnInitRecovery();
									$('#allot_recovery').combobox('clear');
									$('#allot_recovery').combobox("setValue",'--请选择--'); 
									$('#recoveryNode2').combobox("setValue",'--请选择--'); 
								});
							} else {
								$.messager.alert("操作提示", "回收异常,原因: " + data.RSP_BODY.exMsg, "error");
								fnQuery();
								fnInitRecovery();
								$('#allot_recovery').combobox('clear');
								$('#allot_recovery').combobox("setValue",'--请选择--'); 
								$('#recoveryNode2').combobox("setValue",'--请选择--'); 
								return;
							}
						}
					});
				}
			}	
			
			function onFuZhi(value){
				onCheckNow(value);
				var count="";
				if(value==3){
					count=$('#info_todayApp3').text();
					$("input[name='recoveryNum']").val(count);
				}else if(value==4){
					count=$('#info_todayApp4').text();
					$("input[name='recoveryNum2']").val(count);
				}
			}
			//当日新接收  待转移或回收申请件 
			function onCheckNow(value){
				var seachForm = $("#seachForm");
				var jsondata = getFormMulData(seachForm.serializeArray());
				var curr='',currCode='',id ='',isHangUp='';
				if(value==1){
					isHangUp='1';
					id = $("input[name='transferId']").val();
					curr = $("#id_tree_type  option:selected").val(); 
					if (curr == null || curr == ""|| curr == "-1") {
						 $.messager.alert("操作提示","要被转移件的队列 必须被选中 ","error");
						return;
					} else {
						currCode =curr.substring(0,curr.length-1);
					}
					
				}else if(value==2){
					isHangUp='1';
					id = $("input[name='transferId']").val();
					curr = $("#id_tree_type2  option:selected").val(); 
					if (curr == null || curr == ""|| curr == "-1") {
						 $.messager.alert("操作提示","要被转移件的组  必须被选中 ","error");
						return;
					} else {
						currCode =curr.substring(0,curr.length-1);
					}
				}else if(value==3){
					 id=$("input[name='recoveryId']").val();
					curr = $("#id_recovery_type  option:selected").val();
					if (curr == null || curr == ""|| curr == "-1") {
						 $.messager.alert("操作提示","要被回收件的队列  必须被选中 ","error");
						return;
					} else {
						currCode =curr.substring(0,curr.length-1);
					}
				}else if(value==4){
					 id=$("input[name='recoveryId']").val();
					curr = $("#id_recovery_type  option:selected").val();
					if (curr == null || curr == ""|| curr == "-1") {
						 $.messager.alert("操作提示","要被回收件的组必须被选中  ","error");
						return;
					} else {
						currCode =curr.substring(0,curr.length-1);
					}
				}
				if(isHangUp=='1'){
					jsondata.isHangUp=isHangUp;
				}
				$cf.ajax({
					url : "/opas-allot-server/countTodayApp.json",
					data:{
						'value':value,
						'id':id,
						'node':node,
						'secondNode':secondNode,
						'currCode':currCode,
						'ydjFlag':'2',
						'userCode':userCode,
						'jsondata':jsondata
						},
					onSuccess : function(data) {
						var count = data.RSP_BODY.total;
						if(value==1){//转移队列当日件赋值
							$('#info_todayApp').text(count);
						}else if(value==2){//转移组当日件赋值 
							$('#info_todayApp2').text(count);
						}else if(value==3){//回收队列 当日件赋值 
							$('#info_todayApp3').text(count);
						}else if(value==4){//回收组当日件赋值  
							$('#info_todayApp4').text(count);
						}
					}
				});
			}
		function getvalue() {
			var ss;
			$('input[name="queue"]:checked').each(function() {
				var sss = $(this).val();
				var ssss = $("#" + sss).val();
				if (ssss == null || ssss == "") {
					alert("勾选后必须输入值");
				}
				alert(ssss);
				ss = ss + "," + $(this).val();
			})
			var s = $("#write1").val();
		}
		function fnReset(){
			var id=$("input[name='hiddenId']").val();
			if(id==1){
				if(node==01||node==03){
					$("#allotTable4 tr td input[type=text]").val("");
				}else if(node==02){
					$("#allotTable tr td input[type=text]").val("");
				}
				var checklist=document.getElementsByName("queueorgroup");
				for(var j=0;j<checklist.length;j++){
					checklist[j].checked=0;
				}
				document.getElementById("all").checked=0;
			}else if(id==2){
				if(node==01||node==03){
					$("#allotTable5 tr td input[type=text]").val("");
				}else if(node==02){
					$("#allotTable2 tr td input[type=text]").val("");
				}
				var checklist=document.getElementsByName("queueorgroup2");
				for(var j=0;j<checklist.length;j++){
					checklist[j].checked=0;
				}
				document.getElementById("all2").checked=0;
			}else if(id==3){
				document.getElementById("combox_2_level").value='-1';
				if(node==01||node==03){
					$("#allotTable6 tr td input[type=text]").val("");
				}else if(node==02){
					$("#allotTable3 tr td input[type=text]").val("");
				}
			}
			//如果重置  重新计算待分配件和已分配件  剩余件
			fnJiSuan('2');
		}
	</script>
</body>
</html>